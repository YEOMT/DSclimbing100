<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì†¡ ë“±ë°˜: 100êµì‹œì˜ ì „ì„¤ v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react/dist/lucide-react.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #000;
            color: white;
            overflow: hidden;
            user-select: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

       #game-container {
            /* [ìˆ˜ì •ë¨] í™”ë©´ ê½‰ ì°¸ ë°©ì§€ ë° ì—¬ë°± í™•ë³´ */
            width: 95vw;          /* ê°€ë¡œ: í™”ë©´ ë„ˆë¹„ì˜ 95%ë§Œ ì‚¬ìš© (ì¢Œìš° ì—¬ë°±ìƒê¹€) */
            max-width: 1280px;    /* ìµœëŒ€ í¬ê¸°ëŠ” ìœ ì§€ */
            max-height: 90vh;     /* ì„¸ë¡œ: í™”ë©´ ë†’ì´ì˜ 90%ë§Œ ì‚¬ìš© (ìœ„ì•„ë˜ ì—¬ë°±ìƒê¹€) */
            aspect-ratio: 16 / 9; /* 16:9 ë¹„ìœ¨ ê³ ì • */
            
            /* ë””ìì¸ ìš”ì†Œ (ê¸°ì¡´ê³¼ ë™ì¼) */
            background-color: #0f172a;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            border: 2px solid #334155;
            border-radius: 12px;  /* [ì¶”ê°€ë¨] ì—¬ë°±ì´ ìƒê¸´ ê¹€ì— ëª¨ì„œë¦¬ë„ ì‚´ì§ ë‘¥ê¸€ê²Œ */
        }

        @keyframes shake-hard {
            0% { transform: translate(0px, 0px) rotate(0deg); }
            10% { transform: translate(-4px, -4px) rotate(-2deg); }
            20% { transform: translate(4px, 4px) rotate(2deg); }
            30% { transform: translate(-6px, 2px) rotate(-4deg); }
            40% { transform: translate(6px, -2px) rotate(4deg); }
            50% { transform: translate(-4px, -4px) rotate(-2deg); }
            60% { transform: translate(4px, 4px) rotate(2deg); }
            70% { transform: translate(-2px, 2px) rotate(-1deg); }
            80% { transform: translate(2px, -2px) rotate(1deg); }
            90% { transform: translate(-1px, 1px) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .hit-effect { animation: shake-hard 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        .card-exhaust { opacity: 0.7; border-style: dashed; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .rank-table th { background-color: #1e293b; color: #94a3b8; padding: 12px; }
        .rank-table td { border-bottom: 1px solid #334155; padding: 12px; }
        .rank-table tr:hover { background-color: #334155; }
/* íƒ€ê²©ê° íš¨ê³¼ (v1.5 ì¶”ê°€) */
        @keyframes float-up { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -150%) scale(1.2); } }
        @keyframes boom { 0% { transform: translate(-50%, -50%) scale(0.5); } 50% { transform: translate(-50%, -50%) scale(1.5); } 100% { opacity: 0; transform: translate(-50%, -150%) scale(1); } }
        @keyframes pulse-red { 0%, 100% { box-shadow: inset 0 0 0 0 transparent; } 50% { box-shadow: inset 0 0 50px 20px rgba(239, 68, 68, 0.7); background-color: rgba(239, 68, 68, 0.3); } }
        
        .dmg-num { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 100; font-weight: 900; text-shadow: 2px 2px 0 #000, -1px -1px 0 #000; white-space: nowrap; }
        .dmg-normal { font-size: 2.5rem; color: white; animation: float-up 0.8s ease-out forwards; }
        .dmg-crit { font-size: 3.5rem; color: #facc15; animation: float-up 0.8s ease-out forwards; } /* 25 ì´ìƒ */
        .dmg-super { font-size: 5rem; color: #ef4444; animation: boom 0.8s ease-out forwards; } /* 45 ì´ìƒ */
        .flash-red { animation: pulse-red 0.5s ease-in-out; }
    </style>
</head>
<body>
    <div id="root" class="w-full h-full flex items-center justify-center"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // [1. Firebase ì—°ê²° ì„¤ì •]
        const firebaseConfig = {
              apiKey: "AIzaSyBtK7NAfw4wDsS4LRacWF78PHT3zls50IQ",
              authDomain: "dsgames-fecef.firebaseapp.com",
              projectId: "dsgames-fecef",
              storageBucket: "dsgames-fecef.firebasestorage.app",
              messagingSenderId: "723943517090",
              appId: "1:723943517090:web:3e8596971cedf46cc460fb",
              measurementId: "G-GNVR6N4LKQ"
        };

        // [2. ì„œë²„ ì‹œë™ ê±¸ê¸°]
        let db;
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch (e) { console.error("ì„œë²„ ì—°ê²° ì‹¤íŒ¨:", e); }

       // BGM IDs applied from user request (ë³´ìŠ¤ë³„ BGM ë¶„ë¦¬ë¨)
        const BGM_IDS = {
            MENU: "https://www.dropbox.com/scl/fi/r4hdysk5ijx2ss2u5gfvn/_MainMenu.mp3?rlkey=1raauvmuk3wsbhsq88yl0ghwd&st=rti2rjmt&dl=1", 
            NORMAL_1: "https://www.dropbox.com/scl/fi/czw39hbkhjqe5r9lq1k86/Normal-Classes1.mp3?rlkey=727a9wx08aeirkbyvjqdb5xc3&st=tz87scsh&dl=1", 
            NORMAL_2: "https://www.dropbox.com/scl/fi/2zb7lydxs7l9pgasxr1o4/Normal-Classes2.mp3?rlkey=fwfkrxdg5xcu6urgivzba13bn&st=dj0bbzht&dl=1", 
            SHOP: "https://www.dropbox.com/scl/fi/ryqyshlgzxbg9rydstvrc/_Shopping.mp3?rlkey=1appq53idoyy2pa0hnnrqtwry&st=zjm8dzh7&dl=1", 
            
            // [ìˆ˜ì •] ë³´ìŠ¤ ìŠ¤í…Œì´ì§€ BGM ê°œë³„ ë¶„ë¦¬ (ë§í¬ë¥¼ ì›í•˜ëŠ” ê³¡ìœ¼ë¡œ ìˆ˜ì •í•˜ì„¸ìš”)
            BOSS_20: "https://www.dropbox.com/scl/fi/4wx7wvdmz5e7wh54xqdbl/2040BOSS.mp3?rlkey=x03pwevolgcbjd0o1x6ibu4wb&st=1ha10ep7&dl=1",
            BOSS_40: "https://www.dropbox.com/scl/fi/4wx7wvdmz5e7wh54xqdbl/2040BOSS.mp3?rlkey=x03pwevolgcbjd0o1x6ibu4wb&st=1ha10ep7&dl=1",
            BOSS_60: "https://www.dropbox.com/scl/fi/ul8fhavfxxt3uabvwush3/60BOSS.mp3?rlkey=nrw2yv65pba3he8mqm3pheyqa&st=kltwivgd&dl=1",
            
            BOSS_80: "https://www.dropbox.com/scl/fi/npeg3by2fmzikaybv97hw/80BOSS.mp3?rlkey=5d0fjojdtzowy8fahsqdgrpl4&st=481ir60o&dl=1",
            
            BOSS_98: "https://www.dropbox.com/scl/fi/5gbzg71s8dot9ajoglhdp/98BOSS.mp3?rlkey=nbdacolvi92v8vlkqyqq5yecn&st=73buw3pv&dl=1",
            BOSS_99: "https://www.dropbox.com/scl/fi/1zy8inzfj0li6y557j1x8/99BOSS.mp3?rlkey=yepnv219mqfoveo89t9cpcgqo&st=pfh3nkd5&dl=1",
            
            BOSS_FINAL: "https://www.dropbox.com/scl/fi/g349n4jwmnj5yzonktj37/100BOSS.mp3?rlkey=wm0y9sey9ma021a4hbjuo7t6c&st=ul63fbih&dl=1",
            
            VICTORY: "https://www.dropbox.com/scl/fi/5vi1f2v132e3qug3mp4z1/_Legendary-Student.mp3?rlkey=p8vw6ven0w3q9qix56h6hhbve&st=0fv2an24&dl=1",
            GAMEOVER: "https://www.dropbox.com/scl/fi/fzo7az101gid4q4q4amn8/_GameOver.mp3?rlkey=2oxxb9945jfk85k2dlhqbez62&st=gmneth32&dl=1" 
        };

        // --- 8-bit Retro Sound Generator (No external files needed) ---
        const playRetroSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.connect(gain);
                gain.connect(ctx.destination);

                if (type === 'hit') {
                    // Noise burst for hit
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.5, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.1);
                } else if (type === 'heal') {
                    // Rising chime
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(800, ctx.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.3, ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                } else if (type === 'click') {
                    // Short blip
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800, ctx.currentTime);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.05);
                }
            } catch (e) {
                console.error("Audio error", e);
            }
        };

      const Icon = ({ name, size = 24, className, ...props }) => {
            const icons = {
                Heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>,
                Brain: <g><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></g>,
                Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>,
                Coins: <g><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m7.1 10.28 1.4.6"/></g>,
                ShoppingCart: <g><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></g>,
                Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>,
                Skull: <g><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></g>,
                ArrowUp: <g><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></g>,
                Trash2: <g><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></g>,
                CheckCircle: <g><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></g>,
                Wind: <g><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></g>,
                ArrowRight: <g><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></g>,
                Volume2: <g><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></g>,
                VolumeX: <g><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></g>,
                // [ìˆ˜ì •ë¨] ì•„ë˜ Trophy ë¶€ë¶„ì— <g> íƒœê·¸ë¥¼ ì¶”ê°€í•˜ì—¬ ì˜¤ë¥˜ í•´ê²°
                Trophy: <g><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></g>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const SUBJECTS = {
            BASIC: { id: 'BASIC', name: 'ì¼ë°˜', emoji: 'ğŸ’', teacher: 'ë‹´ì„', teacherEmoji: 'ğŸ§‘â€ğŸ«', desc: 'ê¸°ë³¸ì ì¸ í•™êµ ìƒí™œì…ë‹ˆë‹¤.' },
            KOREAN: { id: 'KOREAN', name: 'êµ­ì–´', emoji: 'ğŸ“œ', teacher: 'ì´ì†Œì •', teacherEmoji: 'ğŸ‘©â€ğŸ«', desc: 'ë“œë¡œìš°ì™€ ê³µê²©ì´ ê· í˜• ì¡íŒ ê³¼ëª©ì…ë‹ˆë‹¤.' },
            MATH: { id: 'MATH', name: 'ìˆ˜í•™', emoji: 'ğŸ“', teacher: 'ì•ˆë‚˜í˜„', teacherEmoji: 'ğŸ‘¨â€ğŸ«', desc: 'ê³„ì‚°ê³¼ ì½¤ë³´ë¡œ í­ë°œì ì¸ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.' },
            ENGLISH: { id: 'ENGLISH', name: 'ì˜ì–´', emoji: 'ğŸ…°ï¸', teacher: 'ì—¼ì •í˜„', teacherEmoji: 'ğŸ‘±â€â™‚ï¸', desc: 'ê¸°ì ˆ, íšŒí”¼ ë“± ë‹¤ì–‘í•œ ìœ í‹¸ë¦¬í‹°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.' },
            SCIENCE: { id: 'SCIENCE', name: 'ê³¼í•™', emoji: 'ğŸ§ª', teacher: 'ê°•ê²½í™˜', teacherEmoji: 'ğŸ§‘â€ğŸ”¬', desc: 'ìì‹ ì˜ ì²´ë ¥ì„ ëŒ€ê°€ë¡œ ê°•ë ¥í•œ ìœ„ë ¥ì„ ëƒ…ë‹ˆë‹¤.' },
            HISTORY: { id: 'HISTORY', name: 'ì—­ì‚¬', emoji: 'ğŸº', teacher: 'ì§€ì—°ìš°', teacherEmoji: 'ğŸ‘¨', desc: 'ì§€ì† ë°ë¯¸ì§€ì™€ ë²„í‹°ê¸°ì— íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' },
            TECH: { id: 'TECH', name: 'ê¸°ìˆ ', emoji: 'ğŸ”§', teacher: 'ì•ˆí˜•ì§„', teacherEmoji: 'ğŸ‘·', desc: 'ì¹´ë“œ ê°•í™”ì™€ ë°©ì–´ë„ êµ¬ì¶•ì— ìœ ë¦¬í•©ë‹ˆë‹¤.' },
            MUSIC: { id: 'MUSIC', name: 'ìŒì•…', emoji: 'ğŸµ', teacher: 'ê¹€ì˜ì£¼', teacherEmoji: 'ğŸ‘©â€ğŸ¤', desc: 'ì •ì‹ ë ¥ íšŒë³µê³¼ ê¸°ì ˆ íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.' },
            ART: { id: 'ART', name: 'ë¯¸ìˆ ', emoji: 'ğŸ¨', teacher: 'ì´ì˜ˆë¦°', teacherEmoji: 'ğŸ‘©â€ğŸ¨', desc: 'íŠ¹ìˆ˜í•œ ë°©ì–´ ê¸°ì œì™€ ê°•ë ¥í•œ ë§ˆë‚˜ ì†Œëª¨ ê³µê²©ì„ í•©ë‹ˆë‹¤.' },
            PE: { id: 'PE', name: 'ì²´ìœ¡', emoji: 'âš½', teacher: 'ì‹ ìœ ì§„', teacherEmoji: 'ğŸ‹ï¸', desc: 'í˜ì„ ëª¨ì•„ ê°•ë ¥í•œ í•œ ë°©ì„ ë‚ ë¦½ë‹ˆë‹¤.' },
            HOME: { id: 'HOME', name: 'ê°€ì •', emoji: 'ğŸ³', teacher: 'ë°•ì§€ì›', teacherEmoji: 'ğŸ‘©â€ğŸ³', desc: 'íšŒë³µê³¼ ë¹„ìš© ê°ì†Œ ë“± ë³´ì¡°ì— ëŠ¥í•©ë‹ˆë‹¤.' },
            ETHICS: { id: 'ETHICS', name: 'ë„ë•', emoji: 'âš–ï¸', teacher: 'ê¹€ì‹ ì˜', teacherEmoji: 'ğŸ§‘â€âš–ï¸', desc: 'ì •ì‹ ë ¥ ê´€ë¦¬ì™€ ë²„í”„ í•´ì œ ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤.' },
            SOCIAL: { id: 'SOCIAL', name: 'ì‚¬íšŒ', emoji: 'ğŸŒ', teacher: 'ì†í˜œë¯¼', teacherEmoji: 'ğŸ‘©â€ğŸ«', desc: 'ë‹¤ë¥¸ êµê³¼ì™€ì˜ ì‹œë„ˆì§€ íš¨ê³¼ë¡œ ë±ì˜ ì ì¬ë ¥ì„ í­ë°œì‹œí‚µë‹ˆë‹¤.' },
            // [ì¶”ê°€] íˆë“  ê³¼ëª©: í•™êµ ê´€ë¦¬ì (ê¸°ë³¸ì ìœ¼ë¡œëŠ” ìˆ¨ê²¨ì§)
            ADMIN: { id: 'ADMIN', name: 'í•™êµ ê´€ë¦¬ì', emoji: 'ğŸ‘‘', teacher: 'êµì¥ê³¼ êµê°', teacherEmoji: 'ğŸ«', desc: 'êµì¥ê³¼ êµê°ì˜ ê¶ŒëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.' },

        };

        const RARITY = {
            COMMON: { id: 'COMMON', name: 'ì¼ë°˜', color: 'bg-white border-slate-300 text-slate-800', probability: 60, price: 1000 },
            SPECIAL: { id: 'SPECIAL', name: 'íŠ¹ë³„', color: 'bg-blue-50 border-blue-400 text-blue-900', probability: 25, price: 2000 },
            RARE: { id: 'RARE', name: 'í¬ê·€', color: 'bg-pink-50 border-pink-400 text-pink-900', probability: 10, price: 3000 },
            LEGEND: { id: 'LEGEND', name: 'ì „ì„¤', color: 'bg-yellow-50 border-yellow-400 text-yellow-900', probability: 5, price: 4000 },
        };

        const RELICS = [
            { id: 'r1', name: 'ì²œì¬ êµê³¼ì„œ', desc: 'ì •ì‹ ë ¥ì„ ì˜êµ¬ì ìœ¼ë¡œ 2 ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.', effect: 'MAX_MANA', val: 2, emoji: 'ğŸ“š' },
            { id: 'r2', name: 'ëŒ€ì†¡ì¤‘ ê¹ƒë°œ', desc: 'í•œ í„´ì— ë“œë¡œìš°í•˜ëŠ” ì¹´ë“œ ìˆ˜ë¥¼ 1 ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.', effect: 'DRAW_PLUS', val: 1, emoji: 'ğŸš©' },
            { id: 'r3', name: 'ëŒ€íšŒ íŠ¸ë¡œí”¼', desc: 'ìµœëŒ€ ì²´ë ¥ì„ 30 ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.', effect: 'MAX_HP', val: 30, emoji: 'ğŸ†' },
            { id: 'r4', name: 'ì»´í“¨í„° ì‹¸ì¸íœ', desc: 'íœ ì°Œë¥´ê¸°ì˜ ë°ë¯¸ì§€ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ 10 ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.', effect: 'PEN_BUFF', val: 10, emoji: 'ğŸ–ï¸' },
            { id: 'r5', name: 'ì´ì˜¨ ìŒë£Œ', desc: 'ë§¤ ì „íˆ¬ ì²« í„´ì— ì •ì‹ ë ¥ì„ 1 ì¶”ê°€ë¡œ ì–»ìŠµë‹ˆë‹¤.', effect: 'START_MANA', val: 1, emoji: 'ğŸ¥¤' },
            { id: 'r6', name: 'ì§€ìš°ê°œ', desc: 'ì „íˆ¬ ì‹œì‘ ì‹œ ëª¨ë“  ì ì—ê²Œ ì•½í™” 1ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.', effect: 'START_WEAK', val: 1, emoji: 'ğŸ§¼' },
            { id: 'r7', name: 'ì–´ë¨¸ë‹ˆì˜ ë„ì‹œë½', desc: 'ì „íˆ¬ê°€ ëë‚  ë•Œë§ˆë‹¤ ì²´ë ¥ì„ 5 íšŒë³µí•©ë‹ˆë‹¤.', effect: 'POST_COMBAT_HEAL', val: 5, emoji: 'ğŸ±' },
            { id: 'r8', name: 'ë…¸ì´ì¦ˆ ìº”ìŠ¬ë§', desc: 'ë§¤ ì „íˆ¬ë§ˆë‹¤ ì²« ë²ˆì§¸ ë””ë²„í”„ë¥¼ ë§‰ì•„ì¤ë‹ˆë‹¤.', effect: 'DEBUFF_IMMUNE', val: 1, emoji: 'ğŸ§' },
            { id: 'r9', name: 'ìŠ¤í„°ë”” í”Œë˜ë„ˆ', desc: 'ì „íˆ¬ ì‹œì‘ ì‹œ ë°©ì–´ë„ 10ì„ ì–»ê³  ì‹œì‘í•©ë‹ˆë‹¤.', effect: 'START_BLOCK', val: 10, emoji: 'ğŸ“…' },
            { id: 'r10', name: 'ìê¸°ì£¼ë„í•™ìŠµ', desc: 'ì „íˆ¬ ì¤‘ ë§¤ í„´ë§ˆë‹¤ ë°©ì–´ë„ê°€ ì‚¬ë¼ì§€ì§€ ì•Šê³  ìœ ì§€ë©ë‹ˆë‹¤.', effect: 'BLOCK_RETAIN', val: 0, emoji: 'ğŸ§±' },
        ];

        const CARD_DATABASE = [
            { id: 'b1', subject: 'BASIC', rarity: 'COMMON', name: 'íœ ì°Œë¥´ê¸°', cost: 2, type: 'ATTACK', val: 8, desc: 'ğŸ–Šï¸ 8ì˜ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.' },
            { id: 'b2', subject: 'BASIC', rarity: 'COMMON', name: 'êµê³¼ì„œ ë°©ì–´', cost: 2, type: 'DEFENSE', val: 7, desc: 'ğŸ›¡ï¸ ë°©ì–´ë„ 7ì„ ì–»ìŠµë‹ˆë‹¤.' },
            { id: 'b3', subject: 'BASIC', rarity: 'SPECIAL', name: 'í•„í†µ í›„ë ¤ì¹˜ê¸°', cost: 4, type: 'ATTACK', val: 4, desc: 'âœï¸ 4ì˜ í”¼í•´ë¥¼ ì£¼ê³  ê¸°ì ˆì‹œí‚µë‹ˆë‹¤.', effect: 'STUN' },
            { id: 'k1', subject: 'KOREAN', rarity: 'COMMON', name: 'ë°›ì•„ì“°ê¸°', cost: 1, type: 'ATTACK', val: 10, desc: 'ğŸ“ 10ì˜ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.' },
            { id: 'k2', subject: 'KOREAN', rarity: 'SPECIAL', name: 'ì‹œ ë‚­ë…', cost: 1, type: 'DEFENSE', val: 10, desc: 'ğŸ“– ë°©ì–´ë„ 10, ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'DRAW', effectVal: 1 },
            { id: 'k3', subject: 'KOREAN', rarity: 'RARE', name: 'í›ˆë¯¼ì •ìŒ', cost: 2, type: 'ATTACK', val: 18, desc: 'ğŸ‡°ğŸ‡· 18ì˜ í”¼í•´, ì ì—ê²Œ ì•½í™” 2 ë¶€ì—¬.', effect: 'WEAK', effectVal: 2 },
            { id: 'k4', subject: 'KOREAN', rarity: 'COMMON', name: 'ìˆ˜í•„ ì“°ê¸°', cost: 1, type: 'SKILL', val: 0, desc: 'âœï¸ ë±ì˜ ê³µê²© ì¹´ë“œë¥¼ 1ì¥ ë³µì‚¬í•˜ì—¬ ì†ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.', effect: 'COPY_ATTACK_FROM_DECK' },
            { id: 'k5', subject: 'KOREAN', rarity: 'LEGEND', name: 'ë¬¸í•™ì˜ ë°¤', cost: 3, type: 'ATTACK', val: 30, desc: 'ğŸŒƒ ëª¨ë“  ì ì—ê²Œ 30 í”¼í•´.', effect: 'AOE_ATTACK' },
            { id: 'k6', subject: 'KOREAN', rarity: 'SPECIAL', name: 'ë§ì¶¤ë²• êµì •', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ’” ì ì—ê²Œ ì·¨ì•½ 1ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.', effect: 'VULNERABLE', effectVal: 1 },
            { id: 'm1', subject: 'MATH', rarity: 'COMMON', name: 'í”¼íƒ€ê³ ë¼ìŠ¤', cost: 1, type: 'ATTACK', val: 9, desc: 'ğŸ“ 9ì˜ í”¼í•´. ì´ì „ ì¹´ë“œê°€ ìˆ˜í•™ì´ë©´ +4 í”¼í•´.', effect: 'MATH_COMBO', effectVal: 4 },
            { id: 'm2', subject: 'MATH', rarity: 'SPECIAL', name: 'ì´ì°¨ë°©ì •ì‹', cost: 2, type: 'ATTACK', val: 15, desc: 'âœ–ï¸ 15ì˜ í”¼í•´. ì†íŒ¨ì˜ ìˆ˜í•™ ì¹´ë“œ ë¹„ìš© -1.', effect: 'MATH_COST_REDUCE' },
            { id: 'm3', subject: 'MATH', rarity: 'RARE', name: 'í™•ë¥ ê³¼ í†µê³„', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ² 50% í™•ë¥ ë¡œ ì •ì‹ ë ¥ 2 íšŒë³µ, ì‹¤íŒ¨ì‹œ ì²´ë ¥ 5 ê°ì†Œ.', effect: 'GAMBLE_MANA' },
            { id: 'm4', subject: 'MATH', rarity: 'LEGEND', name: 'ë¯¸ì ë¶„', cost: 3, type: 'ATTACK', val: 15, desc: 'âˆ« ì´ë²ˆ í„´ ì‚¬ìš©í•œ ìˆ˜í•™ ì¹´ë“œ ìˆ˜ë§Œí¼ í”¼í•´ëŸ‰ 2ë°°ì”© ì¦ê°€ (ê¸°ë³¸ 15).', effect: 'MATH_MULTIPLY' },
            { id: 'm5', subject: 'MATH', rarity: 'COMMON', name: 'ì›ë¿” ì°Œë¥´ê¸°', cost: 2, type: 'ATTACK', val: 12, desc: 'ğŸ“ 12ì˜ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.' },
            { id: 'm6', subject: 'MATH', rarity: 'SPECIAL', name: 'êµ¬êµ¬ë‹¨', cost: 0, type: 'SKILL', val: 0, desc: 'âœ–ï¸ ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'DRAW', effectVal: 1 },
            { id: 'e1', subject: 'ENGLISH', rarity: 'COMMON', name: 'ì§€ê°ë™ì‚¬', cost: 1, type: 'ATTACK', val: 6, desc: 'ğŸ‘€ 6ì˜ í”¼í•´. ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'DRAW', effectVal: 1 },
            { id: 'e2', subject: 'ENGLISH', rarity: 'SPECIAL', name: 'ì›ì–´ë¯¼ íšŒí™”', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸ—£ï¸ ì ì„ 1í„´ê°„ ê¸°ì ˆì‹œí‚µë‹ˆë‹¤.', effect: 'STUN' },
            { id: 'e3', subject: 'ENGLISH', rarity: 'RARE', name: 'ê°„ì ‘ ì˜ë¬¸ë¬¸', cost: 1, type: 'DEFENSE', val: 12, desc: 'â“ ë°©ì–´ë„ 12. ë‹¤ìŒ í„´ ì ì˜ ê³µê²© 1íšŒ ë¬´íš¨í™”.', effect: 'DODGE' },
            { id: 'e4', subject: 'ENGLISH', rarity: 'COMMON', name: 'ë‹¨ì–´ ì‹œí—˜', cost: 0, type: 'ATTACK', val: 7, desc: 'ğŸ…°ï¸ 7ì˜ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.', },
            { id: 'e5', subject: 'ENGLISH', rarity: 'RARE', name: 'ìˆ˜ë™íƒœ', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ›¡ï¸ í˜„ì¬ ë°©ì–´ë„ë¥¼ 3ë°°ë¡œ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.', effect: 'BLOCK_MULTIPLY', effectVal: 3 },
            { id: 'e6', subject: 'ENGLISH', rarity: 'LEGEND', name: 'ë³¸ë¬¸ í•´ì„', cost: 1, type: 'ATTACK', val: 0, desc: 'ğŸ“– ë°©ì–´ë„ ìˆ˜ì¹˜ë§Œí¼ ì ì—ê²Œ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.', effect: 'BODY_SLAM' },
            { id: 's1', subject: 'SCIENCE', rarity: 'COMMON', name: 'ì‘ìš© ë°˜ì‘ìš©', cost: 0, type: 'ATTACK', val: 12, desc: 'ğŸ’¥ 12 í”¼í•´. ë‚´ ì²´ë ¥ 3 ê°ì†Œ.', selfDamage: 3 },
            { id: 's2', subject: 'SCIENCE', rarity: 'SPECIAL', name: 'í•µë¶„ì—´', cost: 2, type: 'ATTACK', val: 25, desc: 'â˜¢ï¸ 25 í”¼í•´. ë‚´ ì²´ë ¥ 5 ê°ì†Œ.', selfDamage: 5 },
            { id: 's3', subject: 'SCIENCE', rarity: 'RARE', name: 'ì„¸í¬ ë¶„ì—´', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ¦  ë±ì˜ ë¬´ì‘ìœ„ ê³µê²© ì¹´ë“œë¥¼ ë³µì œí•˜ì—¬ ì†ì— ê°€ì ¸ì˜µë‹ˆë‹¤.', effect: 'DUPLICATE_ATTACK' },
            { id: 's4', subject: 'SCIENCE', rarity: 'LEGEND', name: 'ë¹…ë±…', cost: 4, type: 'ATTACK', val: 50, desc: 'ğŸŒŒ ëª¨ë“  ì ì—ê²Œ 50 í”¼í•´. ë‚´ ì²´ë ¥ 10 ê°ì†Œ.', effect: 'AOE_ATTACK', selfDamage: 10 },
            { id: 's5', subject: 'SCIENCE', rarity: 'COMMON', name: 'ê´‘í•©ì„±', cost: 1, type: 'SKILL', val: 0, desc: 'â˜€ï¸ ì²´ë ¥ì„ 5 íšŒë³µí•©ë‹ˆë‹¤.', effect: 'HEAL', effectVal: 5 },
            { id: 's6', subject: 'SCIENCE', rarity: 'SPECIAL', name: 'ì‚°í™”', cost: 2, type: 'ATTACK', val: 8, desc: 'ğŸ§ª 8ì˜ í”¼í•´, ì ì—ê²Œ ì·¨ì•½ 1 ë¶€ì—¬.', effect: 'VULNERABLE_ATTACK', effectVal: 1 },
            { id: 'h1', subject: 'HISTORY', rarity: 'COMMON', name: 'ë…ë¦½ìš´ë™', cost: 1, type: 'ATTACK', val: 5, desc: 'ğŸ‡°ğŸ‡· 5 í”¼í•´ë¥¼ ì£¼ê³ , ë…(ë§¤ í„´ í”¼í•´) 3 ë¶€ì—¬.', effect: 'POISON', effectVal: 3 },
            { id: 'h2', subject: 'HISTORY', rarity: 'SPECIAL', name: 'ì‚°ì—…í˜ëª…', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ­ ì´ë²ˆ ì „íˆ¬ ë™ì•ˆ ë§¤ í„´ ì‹œì‘ ì‹œ ë°©ì–´ë„ 5 íšë“.', effect: 'BUFF_BLOCK', effectVal: 5 },
            { id: 'h3', subject: 'HISTORY', rarity: 'RARE', name: 'ì„¸ê³„ 4ëŒ€ ë¬¸ëª…', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸŒ ì  ì „ì²´ì—ê²Œ 6 í”¼í•´ë¥¼ ì£¼ê³  ë… 5 ë¶€ì—¬. (ì†Œë©¸)', effect: 'AOE_DMG_POISON', val: 6, effectVal: 5, exhaust: true },
            { id: 'h4', subject: 'HISTORY', rarity: 'LEGEND', name: 'ì—­ì‚¬ì˜ ìˆ˜ë ˆë°”í€´', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ¡ ì ì˜ ë… ì¤‘ì²©ì„ 2ë°°ë¡œ ë§Œë“­ë‹ˆë‹¤.', effect: 'DOUBLE_POISON' },
            { id: 'h5', subject: 'HISTORY', rarity: 'SPECIAL', name: 'ì§ì§€ì‹¬ì²´ìš”ì ˆ', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ“œ ì²´ë ¥ì„ 10 íšŒë³µí•©ë‹ˆë‹¤. (ì†Œë©¸)', effect: 'HEAL', effectVal: 10, exhaust: true },
            { id: 'h6', subject: 'HISTORY', rarity: 'COMMON', name: 'í‘ì‚¬ë³‘', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ€ ì ì—ê²Œ ë… 5ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.', effect: 'POISON', effectVal: 5 },
            { id: 't1', subject: 'TECH', rarity: 'RARE', name: 'ì¦ê¸° ê¸°ê´€', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸš‚ ì†íŒ¨ì˜ ì¹´ë“œ ê°•í™” (+1).', effect: 'UPGRADE_HAND', effectVal: 1 },
            { id: 't2', subject: 'TECH', rarity: 'COMMON', name: 'ë©”ì´ì»¤ì‹¤', cost: 1, type: 'DEFENSE', val: 6, desc: 'ğŸ”¨ ë°©ì–´ë„ 6. ë± ë§¨ ìœ„ ì¹´ë“œ ê°•í™” (ì „íˆ¬ ì¤‘).', effect: 'UPGRADE_DECK_TOP' },
            { id: 't3', subject: 'TECH', rarity: 'RARE', name: 'ì•„ì¹˜ êµ¬ì¡°', cost: 1, type: 'DEFENSE', val: 15, desc: 'ğŸŒ‰ ë°©ì–´ë„ 15ë¥¼ ì–»ìŠµë‹ˆë‹¤.' },
            { id: 't4', subject: 'TECH', rarity: 'LEGEND', name: 'ì •ìˆ˜ë¦¬ ì°ê¸°', cost: 3, type: 'ATTACK', val: 40, desc: 'ğŸ”¨ 40 í”¼í•´ë¥¼ ì£¼ê³  ì ì„ ê¸°ì ˆì‹œí‚µë‹ˆë‹¤.', effect: 'STUN_ATTACK' },
            { id: 't5', subject: 'TECH', rarity: 'SPECIAL', name: 'í˜ë‹ˆì‹¤ë¦° ë°œê²¬', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ’Š ì´ë²ˆ í„´ ë™ì•ˆ ë°›ëŠ” í”¼í•´ 0 (ì†Œë©¸).', effect: 'IMMUNE_ONCE', exhaust: true },
            { id: 't6', subject: 'TECH', rarity: 'COMMON', name: 'ë‚˜ë…¸ ë¡œë´‡', cost: 1, type: 'ATTACK', val: 6, desc: 'ğŸ¤– 6 í”¼í•´. ë± ë§¨ ìœ„ ì¹´ë“œ ê°•í™”.', effect: 'ATTACK_UPGRADE_DECK' },
            { id: 'mu1', subject: 'MUSIC', rarity: 'COMMON', name: 'ë‹¨ì†Œ íœ˜ë‘ë¥´ê¸°', cost: 1, type: 'ATTACK', val: 6, desc: 'ğŸ‹ 6 í”¼í•´. 20% í™•ë¥ ë¡œ ê¸°ì ˆ.', effect: 'CHANCE_STUN', effectVal: 20 },
            { id: 'mu2', subject: 'MUSIC', rarity: 'SPECIAL', name: 'ë¹„ë°œë”” ì‚¬ê³„', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ» ì²´ë ¥ì„ 10 íšŒë³µí•©ë‹ˆë‹¤. (ì†Œë©¸)', effect: 'HEAL', effectVal: 10, exhaust: true },
            { id: 'mu3', subject: 'MUSIC', rarity: 'RARE', name: 'í•©ì°½ ëŒ€íšŒ', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸ¤ ì •ì‹ ë ¥ì„ ëª¨ë‘ íšŒë³µí•©ë‹ˆë‹¤. (ì†Œë©¸)', effect: 'RECOVER_MANA_FULL', exhaust: true },
            { id: 'mu4', subject: 'MUSIC', rarity: 'LEGEND', name: 'ê°€ì°½ ìˆ˜í–‰', cost: 3, type: 'SKILL', val: 20, desc: 'ğŸ¤ ì  ì „ì²´ë¥¼ ê¸°ì ˆì‹œí‚¤ê³  20 í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.', effect: 'AOE_STUN_ATTACK', effectVal: 15 },
            { id: 'mu5', subject: 'MUSIC', rarity: 'RARE', name: 'í´ë˜ì‹ ê°ìƒ', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ¼ ì²´ë ¥ 5 íšŒë³µ, ì¹´ë“œ 2ì¥ ë“œë¡œìš°.', effect: 'HEAL_DRAW', effectVal: 5, drawVal: 2 },
            { id: 'mu6', subject: 'MUSIC', rarity: 'SPECIAL', name: 'íœ˜ëª¨ë¦¬ ì¥ë‹¨', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ¥ ì ì—ê²Œ ì·¨ì•½ 1 ë¶€ì—¬, ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'VULNERABLE_DRAW', effectVal: 1 },
            { id: 'a1', subject: 'ART', rarity: 'COMMON', name: 'ì´ˆìƒí™”', cost: 1, type: 'DEFENSE', val: 8, desc: 'ğŸ–¼ï¸ ë°©ì–´ë„ 8ì„ ì–»ìŠµë‹ˆë‹¤.' },
            { id: 'a2', subject: 'ART', rarity: 'SPECIAL', name: 'í’ê²½í™”', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸï¸ ì´ë²ˆ í„´ ë™ì•ˆ ë°›ëŠ” í”¼í•´ê°€ 0ì´ ë©ë‹ˆë‹¤ (1íšŒ).', effect: 'IMMUNE_ONCE' },
            { id: 'a3', subject: 'ART', rarity: 'RARE', name: 'ì¡°ì†Œ', cost: 2, type: 'ATTACK', val: 10, desc: 'ğŸ—¿ 10 í”¼í•´. ë°©ì–´ë„ 10 íšë“.', effect: 'ATTACK_BLOCK' },
            { id: 'a4', subject: 'ART', rarity: 'LEGEND', name: 'ìŠ¤í¬ë˜ì¹˜ ì•„íŠ¸', cost: 0, type: 'ATTACK', val: 0, desc: 'ğŸ”® í˜„ì¬ ì •ì‹ ë ¥ì„ ëª¨ë‘ ì†Œëª¨í•˜ì—¬, ì†Œëª¨í•œ ì–‘ x15 í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.', effect: 'MANA_BURN_ATTACK' },
            { id: 'a5', subject: 'ART', rarity: 'RARE', name: 'ë¬¼ê° ë³´ì¶©', cost: 0, type: 'SKILL', val: 0, desc: 'ğŸ¨ ì •ì‹ ë ¥ 1 íšŒë³µ, ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'MANA_DRAW', effectVal: 1 },
            { id: 'a6', subject: 'ART', rarity: 'SPECIAL', name: 'ì  íƒ±ê¸€', cost: 2, type: 'ATTACK', val: 13, desc: 'ğŸŒ€ 13 í”¼í•´, ì ì—ê²Œ ì•½í™” 1 ë¶€ì—¬.', effect: 'WEAK', effectVal: 1 },
            { id: 'p1', subject: 'PE', rarity: 'SPECIAL', name: 'ê°• ìŠ¤íŒŒì´í¬', cost: 2, type: 'ATTACK', val: 15, desc: 'ğŸ 15 í”¼í•´. ì²´ë ¥ì´ 50% ì´í•˜ë©´ í”¼í•´ 2ë°°.', effect: 'LOW_HP_BONUS' },
            { id: 'p2', subject: 'PE', rarity: 'COMMON', name: 'ì…”í‹€ëŸ°', cost: 0, type: 'ATTACK', val: 3, desc: 'ğŸƒ 3 í”¼í•´. ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'DRAW', effectVal: 1 },
            { id: 'p3', subject: 'PE', rarity: 'RARE', name: 'ë„í•‘(?)', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ’Š ì²´ë ¥ 5 ê°ì†Œ. ì´ë²ˆ í„´ ê³µê²©ë ¥ 2ë°°.', effect: 'DOUBLE_DMG', selfDamage: 5 },
            { id: 'p4', subject: 'PE', rarity: 'RARE', name: 'ì§„ì‹¬ í€ì¹˜', cost: 3, type: 'ATTACK', val: 35, desc: 'ğŸ‘Š í˜ì„ 2 ì–»ê³  35 í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.', effect: 'STRENGTH_ATTACK', effectVal: 2 },
            { id: 'p5', subject: 'PE', rarity: 'SPECIAL', name: 'ê·¼ìœ¡ íŒí•‘', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ’ª ë‹¤ìŒ ê³µê²© ì¹´ë“œì˜ í”¼í•´ëŸ‰ì´ 2ë°°ê°€ ë©ë‹ˆë‹¤.', effect: 'NEXT_ATTACK_DOUBLE' },
            { id: 'p6', subject: 'PE', rarity: 'LEGEND', name: '3ëŒ€ ì¸¡ì •', cost: 0, type: 'SKILL', val: 0, desc: 'ğŸ‹ï¸ ì •ì‹ ë ¥ì„ ëª¨ë‘ ì†Œëª¨í•˜ì—¬ ì†Œëª¨ëŸ‰ì˜ 2ë°°ë§Œí¼ í˜ì„ ì–»ìŠµë‹ˆë‹¤.', effect: 'MANA_BURN_STRENGTH' },
            { id: 'ho1', subject: 'HOME', rarity: 'COMMON', name: 'í† ìŠ¤íŠ¸', cost: 0, type: 'SKILL', val: 0, desc: 'ğŸ ì²´ë ¥ì„ 5 íšŒë³µí•©ë‹ˆë‹¤. (ì†Œë©¸)', effect: 'HEAL', effectVal: 5, exhaust: true },
            { id: 'ho2', subject: 'HOME', rarity: 'SPECIAL', name: 'ë°”ëŠì§ˆ', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ§µ ì†íŒ¨ì˜ ëª¨ë“  ì¹´ë“œ ë¹„ìš© -1 (ì´ë²ˆ í„´ë§Œ).', effect: 'COST_DOWN_HAND' },
            { id: 'ho3', subject: 'HOME', rarity: 'RARE', name: 'ì‚¬ìš°ì–´í¬ë¼í”„íŠ¸ ë¨¹ì´ê¸°', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸ¥¬ ì ì„ ê¸°ì ˆì‹œí‚¤ê³  ë… 5ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.', effect: 'STUN_POISON', effectVal: 5 },
            { id: 'ho4', subject: 'HOME', rarity: 'LEGEND', name: 'íƒ„ë‹¨ì§€ ì„­ì·¨', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸ± ì²´ë ¥ì„ ì™„ì „íˆ íšŒë³µí•©ë‹ˆë‹¤. (ì†Œë©¸)', effect: 'FULL_HEAL', exhaust: true },
            { id: 'ho5', subject: 'HOME', rarity: 'RARE', name: 'í–‰ë³µí•œ ê°€ì¡±', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ì²´ë ¥ 10 íšŒë³µ, ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'HEAL_DRAW', effectVal: 10, drawVal: 1 },
            { id: 'ho6', subject: 'HOME', rarity: 'SPECIAL', name: 'ì—…ì‚¬ì´í´ë§', cost: 2, type: 'DEFENSE', val: 15, desc: 'â™»ï¸ ë°©ì–´ë„ 15, ì¹´ë“œ 1ì¥ ë“œë¡œìš°.', effect: 'BLOCK_DRAW', drawVal: 1 },
            { id: 'et1', subject: 'ETHICS', rarity: 'COMMON', name: 'ê°€ì¹˜ ì°¾ê¸°', cost: 0, type: 'SKILL', val: 0, desc: 'âš–ï¸ ì •ì‹ ë ¥ 1 íšŒë³µ.', effect: 'RECOVER_MANA', effectVal: 1 },
            { id: 'et2', subject: 'ETHICS', rarity: 'SPECIAL', name: 'ë´‰ì‚¬ í™œë™', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ§¹ ì ì˜ ëª¨ë“  ë²„í”„ ì œê±°.', effect: 'DISPEL' },
            { id: 'et3', subject: 'ETHICS', rarity: 'SPECIAL', name: 'ì¹­ì°¬í•˜ê¸°', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ‘ í˜ 2 ì¦ê°€.', effect: 'STRENGTH', effectVal: 2 },
            { id: 'et4', subject: 'ETHICS', rarity: 'LEGEND', name: 'ê°ˆë“± í•´ê²°', cost: 1, type: 'ATTACK', val: 10, desc: 'ğŸ•Šï¸ 10 í”¼í•´. ì‚¬ìš© ì‹œë§ˆë‹¤ ì´ ì¹´ë“œì˜ í”¼í•´ëŸ‰ +4 (ì „íˆ¬ ì¤‘).', effect: 'SCALING_ON_USE', effectVal: 4 },
            { id: 'et5', subject: 'ETHICS', rarity: 'RARE', name: 'ë„ë•ì  ë¹„íŒ', cost: 2, type: 'ATTACK', val: 11, desc: 'ğŸ—£ï¸ 11 í”¼í•´, ì ì—ê²Œ ì·¨ì•½ 1 ë¶€ì—¬.', effect: 'VULNERABLE_ATTACK', effectVal: 1 },
            { id: 'et6', subject: 'ETHICS', rarity: 'RARE', name: 'ë¬´ìœ„ìì—°', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸƒ ì¹´ë“œ 1ì¥ ë“œë¡œìš°, ë‹¤ìŒ ì  ê³µê²© 1íšŒ ë¬´íš¨í™”.', effect: 'DODGE_DRAW', drawVal: 1 },
            { id: 'soc1', subject: 'SOCIAL', rarity: 'COMMON', name: 'ì§€ë¦¬ ë‹µì‚¬', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ—ºï¸ ì†íŒ¨ì˜ ëª¨ë“  ì¹´ë“œë¥¼ ê°•í™”(+1)í•©ë‹ˆë‹¤.', effect: 'UPGRADE_HAND', effectVal: 1 },
            { id: 'soc2', subject: 'SOCIAL', rarity: 'COMMON', name: 'ì •ì¹˜ ë¹„íŒ', cost: 1, type: 'ATTACK', val: 6, desc: 'ğŸ“¢ 6 í”¼í•´. ì ì—ê²Œ ì·¨ì•½ 1(í”¼í•´ 50% ì¦ê°€)ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.', effect: 'VULNERABLE_ATTACK', effectVal: 1 },
            { id: 'soc3', subject: 'SOCIAL', rarity: 'SPECIAL', name: 'ë¬¸í™” ì „íŒŒ', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸŒŠ ë±ì˜ ë¬´ì‘ìœ„ ê³µê²© ì¹´ë“œë¥¼ ë³µì œí•˜ì—¬ ì†ì— ê°€ì ¸ì˜µë‹ˆë‹¤.', effect: 'DUPLICATE_ATTACK' },
            { id: 'soc4', subject: 'SOCIAL', rarity: 'SPECIAL', name: 'ììœ  ë¬´ì—­', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸš¢ ì´ë²ˆ í„´ ë™ì•ˆ ì†íŒ¨ì˜ ëª¨ë“  ì¹´ë“œ ë¹„ìš©ì„ 1 ì¤„ì…ë‹ˆë‹¤.', effect: 'COST_DOWN_HAND' },
            { id: 'soc5', subject: 'SOCIAL', rarity: 'RARE', name: 'ì‹œì¥ ë…ì !', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ“± ì¹´ë“œë¥¼ 3ì¥ ë“œë¡œìš°í•©ë‹ˆë‹¤.', effect: 'DRAW', effectVal: 3 },
            { id: 'soc6', subject: 'SOCIAL', rarity: 'LEGEND', name: 'ë³´ì´ì§€ ì•ŠëŠ” ì†', cost: 2, type: 'SKILL', val: 0, desc: 'ğŸ–ï¸ ì´ë²ˆ í„´ ë™ì•ˆ ì£¼ëŠ” ëª¨ë“  í”¼í•´ê°€ 2ë°°ê°€ ë©ë‹ˆë‹¤.', effect: 'DOUBLE_DMG' },
            // --- [ì¶”ê°€] íˆë“  ì§ì—…: í•™êµ ê´€ë¦¬ì ì¹´ë“œ (OP) ---
            { id: 'ad1', subject: 'ADMIN', rarity: 'SPECIAL', name: 'êµì™¸ì²´í—˜í•™ìŠµ', cost: 1, type: 'SKILL', val: 0, desc: 'âœˆï¸ ì´ë²ˆ í„´ ë™ì•ˆ ëª¨ë“  í”¼í•´ë¥¼ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.', effect: 'IMMUNE_ONCE' },
            { id: 'ad2', subject: 'ADMIN', rarity: 'SPECIAL', name: 'í›ˆí™” ë§ì”€', cost: 1, type: 'SKILL', val: 0, desc: 'ğŸ—£ï¸ ì  ì „ì²´ë¥¼ ê¸°ì ˆì‹œí‚µë‹ˆë‹¤. (ë°ë¯¸ì§€ ì—†ìŒ)', effect: 'AOE_STUN_ONLY' },
            { id: 'ad3', subject: 'ADMIN', rarity: 'RARE', name: 'êµë‚´ ë´‰ì‚¬', cost: 1, type: 'ATTACK', val: 22, desc: 'ğŸ§¹ 22 í”¼í•´ë¥¼ ì£¼ê³  ë… 11ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.', effect: 'POISON', effectVal: 11 },
            { id: 'ad4', subject: 'ADMIN', rarity: 'RARE', name: 'êµë¬´ íšŒì˜', cost: 2, type: 'DEFENSE', val: 22, desc: 'ğŸ“‘ ë°©ì–´ë„ 22, ì¹´ë“œ 3ì¥ ë“œë¡œìš°.', effect: 'BLOCK_DRAW', drawVal: 3 },
            { id: 'ad5', subject: 'ADMIN', rarity: 'LEGEND', name: 'ìƒì¥ ìˆ˜ì—¬', cost: 3, type: 'SKILL', val: 0, desc: 'ğŸ“œ ë‹¤ìŒ ê³µê²© ì¹´ë“œì˜ í”¼í•´ëŸ‰ì´ 3ë°°ê°€ ë©ë‹ˆë‹¤.', effect: 'NEXT_ATTACK_TRIPLE' },
        ];

        const ENEMIES = {
            IN_SCHOOL: [
                { name: 'ë’¤í‹€ë¦° êµê³¼ì„œ', hp: 20, dmg: 5, emoji: 'ğŸ“˜' },
                { name: 'ìœµí•©ëœ ë‹´ë¼ ìº”ë””', hp: 30, dmg: 5, emoji: 'ğŸ¬' },
                { name: 'ë”ì°í•œ ë³€ê¸°', hp: 35, dmg: 6, emoji: 'ğŸš½' },
                { name: 'ì©ì€ ì‚¬ìš°ì–´í¬ë¼í”„íŠ¸', hp: 25, dmg: 8, emoji: 'ğŸ¥¬' },
                { name: 'ë¶„í•„ê°€ë£¨ì˜ ì•…ë§ˆ', hp: 22, dmg: 5, emoji: 'ğŸŒ«ï¸' },
                { name: 'ê³ ì¥ë‚œ ìŠ¤í”¼ì»¤', hp: 35, dmg: 4, emoji: 'ğŸ“¢' },
                { name: 'ì¡°ì‘ëœ ì‹œí—˜ì§€', hp: 30, dmg: 7, emoji: 'ğŸ’¯' },
                { name: 'ëŠì„ì—†ëŠ” í›ˆí™”', hp: 35, dmg: 4, emoji: 'ğŸ—£ï¸' },
                { name: 'ì¡¸ìŒ ê·€ì‹ ', hp: 30, dmg: 5, emoji: 'ğŸ˜ª' },
            ],
            OUT_SCHOOL: [
                { name: 'ê³¨ëª©ê¸¸ ì¼ì§„', hp: 35, dmg: 7, emoji: 'ğŸš¬' },
                { name: 'ë¶ˆë²•ë„ë°• ì„ ë°°', hp: 30, dmg: 7, emoji: 'ğŸƒ' },
                { name: 'í—¤ë¹„ ìŠ¤ëª¨ì»¤', hp: 40, dmg: 6, emoji: 'ğŸŒ«ï¸' },
                { name: 'ì§€ì˜¥ì˜ í‚¥ë³´ë“œ', hp: 30, dmg: 10, emoji: 'ğŸ›´' },
                { name: 'ê°€ì¶œí•œ ì‹¤ë‚´í™”', hp: 25, dmg: 9, emoji: 'ğŸ‘Ÿ' },
                { name: 'í™©ì²œì˜ í•«ë„ê·¸', hp: 22, dmg: 12, emoji: 'ğŸŒ­' },
                { name: 'PCë°© ì£½ëŒì´', hp: 40, dmg: 7, emoji: 'ğŸ§' },
            ]
        };

        const EVENTS = [
            { id: 'ne1', title: "ë°˜ ëŒ€í•­ ì¶•êµ¬ ëŒ€íšŒ", desc: "ì²´ìœ¡ëŒ€íšŒ ì˜ˆì„ ì „ì´ë‹¤! ìš°ë¦¬ ë°˜ì˜ ìŠ¹ë¦¬ë¥¼ ìœ„í•´...", choices: [{ txt: "ì°¸ê°€í•œë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ìš°ìŠ¹í–ˆë‹¤! ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ì‘ì›í•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 15 }, msg: "ëª©ì´ ì‰¬ì—ˆë‹¤. ì²´ë ¥ +15" }] },
            { id: 'ne2', title: "ëª¨ë¥´ëŠ” ë¬¸ì œ", desc: "ìˆ˜í•™ ë¬¸ì œê°€ ë„ˆë¬´ ì–´ë µë‹¤. ëˆ„êµ¬ì—ê²Œ ë¬¼ì–´ë³¼ê¹Œ?", choices: [{ txt: "ìµœì˜ê´‘", res: "GOOD", reward: { type: 'UPGRADE_RANDOM', cost: 0 }, msg: "ì¹œì ˆí•˜ê²Œ ì•Œë ¤ì¤¬ë‹¤. ì¹´ë“œ 1ì¥ ê°•í™”" }, { txt: "ê°•ì„±í˜„", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ì˜¤íˆë ¤ ë” í—·ê°ˆë¦¬ê²Œ ë§Œë“¤ì—ˆë‹¤. ë‹¤ìŒ ì „íˆ¬ ì •ì‹ ë ¥ -1" }, { txt: "ì „í˜œì„±", res: "GOOD", reward: { type: 'GOLD', val: 200 }, msg: "ì•Œë ¤ì£¼ëŠ” ëŒ€ì‹  ë§¤ì  ë¹µì„ ìš”êµ¬í–ˆë‹¤. 200ì› íšë“(??)" }] },
            { id: 'ne3', title: "ì§€í˜¸ì§€í˜¸ì˜ ê¸°ë¬˜í•œ ëª¨í—˜", desc: "ë³µë„ì—ì„œ ì§€í˜¸ê°€ ê¸°ë¬˜í•œ í¬ì¦ˆë¥¼ ì·¨í•˜ê³  ìˆë‹¤.", choices: [{ txt: "ê°™ì´ í¬ì¦ˆë¥¼ ì·¨í•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 20 }, msg: "ê¸°ë¬˜í•œ ì—ë„ˆì§€ê°€ ì†Ÿì•„ë‚œë‹¤! ì²´ë ¥ +20" }, { txt: "ë¬´ì‹œí•œë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 2 }, msg: "ë¶€ë„ëŸ¬ì›€ì€ ë‚˜ì˜ ëª«... ì²´ë ¥ -2" }] },
            { id: 'ne4', title: "ìì „ê±°ì˜ ì–‘ë¯¼ê¸°", desc: "ì–‘ë¯¼ê¸°ê°€ ë³µë„ì—ì„œ ìì „ê±°ë¥¼ íƒ€ê³  ëŒì§„í•´ì˜¨ë‹¤!", choices: [{ txt: "í”¼í•œë‹¤", res: "GOOD", reward: { type: 'GOLD', val: 100 }, msg: "í”¼í•˜ë©´ì„œ ë™ì „ì„ ì£¼ì› ë‹¤. 100ì› íšë“" }, { txt: "ë§‰ì•„ì„ ë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 10 }, msg: "ì¹˜ì˜€ë‹¤... ì²´ë ¥ -10" }] },
            { id: 'ne5', title: "ì†ŒìŒ íŠ¸ë¦¬ì˜¤", desc: "ìµœì¤€ì„œ, ìµœìœ¤í›„, ìµœì„±ë¯¼ì´ êµì‹¤ì—ì„œ EDMì„ í‹€ê³  ì¶¤ì¶”ê³  ìˆë‹¤.", choices: [{ txt: "ê°™ì´ ì¶¤ì¶˜ë‹¤", res: "GOOD", reward: { type: 'UPGRADE_RANDOM', cost: 0 }, msg: "ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ! ì¹´ë“œ 1ì¥ ê°•í™”" }, { txt: "ì¡°ìš©íˆ í•˜ë¼ê³  í•œë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 2 }, msg: "ë¬´ì‹œë‹¹í–ˆë‹¤. ìŠ¤íŠ¸ë ˆìŠ¤... ë‹¤ìŒ ì „íˆ¬ ì •ì‹ ë ¥ -2" }] },
            { id: 'ne6', title: "ì´ë‹¤ì˜¨ì˜ ë°°êµ¬ ë ˆìŠ¨", desc: "ì´ë‹¤ì˜¨ì´ ìŠ¤íŒŒì´í¬ ì‹œë²”ì„ ë³´ì´ê³  ìˆë‹¤.", choices: [{ txt: "ë°°ìš´ë‹¤", res: "GOOD", reward: { type: 'PERM_STRENGTH', val: 1 }, msg: "ì†ë§›ì„ ì•Œì•˜ë‹¤! ì˜êµ¬ì ìœ¼ë¡œ í˜ +1" }, { txt: "êµ¬ê²½í•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 10 }, msg: "ë³´ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ìš´ë™ì´ ëœë‹¤. ì²´ë ¥ +10" }] },
            { id: 'ne7', title: "ì§€ì—°ìš° ì„ ìƒë‹˜ì˜ í˜¸ì¶œ", desc: "ì—­ì‚¬ ì„ ìƒë‹˜ì´ ë¶€ë¥´ì‹ ë‹¤. ë‚´ê°€ ë­˜ ì˜ëª»í–ˆë‚˜?", choices: [{ txt: "ê°„ë‹¤", res: "GOOD", reward: { type: 'GOLD', val: 500 }, msg: "ì‹¬ë¶€ë¦„ ê°’ì´ì—ˆë‹¤. 500ì› íšë“!" }, { txt: "ë„ë§ê°„ë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 5 }, msg: "ë„˜ì–´ì¡Œë‹¤. ì²´ë ¥ -5" }] },
            { id: 'ne8', title: "ì—¼ì •í˜„ ì„ ìƒë‹˜ì˜ ì§", desc: "ì˜ì–´ ì„ ìƒë‹˜ì´ ì§ì„ ë“¤ê³  ê³„ì‹ ë‹¤.", choices: [{ txt: "ë…¸íŠ¸ë¶", res: "GOOD", reward: { type: 'UPGRADE_RANDOM', cost: 0 }, msg: "ê°€ë³ë‹¤! ì¹´ë“œ 1ì¥ ê°•í™”" }, { txt: "ë¬¼í†µ", res: "GOOD", reward: { type: 'HEAL', val: 15 }, msg: "ì‹œì›í•œ ë¬¼ì„ í•œ ì” ì£¼ì…¨ë‹¤. ì²´ë ¥ +15" }, { txt: "í•™ìŠµì§€", res: "BAD", reward: { type: 'HP_LOSS', val: 5 }, msg: "ë„ˆë¬´ ë¬´ê²ë‹¤... í—ˆë¦¬ ì‚ë—. ì²´ë ¥ -5" }] },
            { id: 'ne9', title: "ì‚¬íƒ• êµ¬ê±¸", desc: "ë‹¹ì´ ë–¨ì–´ì§„ë‹¤. êµë¬´ì‹¤ë¡œ ê°€ì.", choices: [{ txt: "ì˜¤ì§€í˜„ T", res: "GOOD", reward: { type: 'HEAL', val: 20 }, msg: "ì´ˆì½œë¦¿ì„ ì£¼ì…¨ë‹¤! ì²´ë ¥ +20" }, { txt: "ì´ì˜ˆë¦° T", res: "GOOD", reward: { type: 'GOLD', val: 300 }, msg: "ë§¤ì  ê°€ë¼ë©° ìš©ëˆì„ ì£¼ì…¨ë‹¤. 300ì› íšë“" }, { txt: "ì „ë™ì„  T", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ì˜ì–´ ë‹¨ì–´ ì‹œí—˜ì„ ë³´ì…¨ë‹¤... ì •ì‹ ë ¥ -1" }] },
            { id: 'ne10', title: "ì• ë‹ˆë©”ì´ì…˜ ë™ì•„ë¦¬", desc: "ì‹ ì„¤ ë™ì•„ë¦¬ ê°€ì… ê¶Œìœ ë¥¼ ë°›ì•˜ë‹¤.", choices: [{ txt: "ê°€ì…í•œë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ë•ë ¥ì´ ìƒìŠ¹í–ˆë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ê±°ì ˆí•œë‹¤", res: "GOOD", reward: { type: 'GOLD', val: 100 }, msg: "íšŒë¹„ë¥¼ ì•„ê¼ˆë‹¤. 100ì› íšë“" }] },
            { id: 'ne11', title: "êµê° ì„ ìƒë‹˜ì˜ ë“±ì¥", desc: "ìˆ ë˜ì¡ê¸°í•˜ë‹¤ ë”± ê±¸ë ¸ë‹¤.", choices: [{ txt: "ì£„ì†¡í•©ë‹ˆë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 5 }, msg: "ìš©ì„œí•´ì£¼ì…¨ë‹¤. ì•ˆë„ê°ì— ì²´ë ¥ +5" }, { txt: "ë„ë§ê°„ë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 10 }, msg: "ì¡í˜”ë‹¤... ì–¼ì°¨ë ¤. ì²´ë ¥ -10" }] },
            { id: 'ne12', title: "ì•ˆì¤€ì„œì˜ ë³µì‹±", desc: "ì•ˆì¤€ì„œê°€ ì‰ë„ìš° ë³µì‹± ì¤‘ì´ë‹¤.", choices: [{ txt: "ìŠ¤íŒŒë§ ì‹ ì²­", res: "BAD", reward: { type: 'HP_LOSS', val: 15 }, msg: "ë§ì•˜ë‹¤. ì²´ë ¥ -15" }, { txt: "ìì„¸ êµì •", res: "GOOD", reward: { type: 'PERM_STRENGTH', val: 1 }, msg: "íƒ€ê²©ê°ì´ ì¢‹ì•„ì¡Œë‹¤. ì˜êµ¬ì ìœ¼ë¡œ í˜ +1" }] },
            { id: 'ne13', title: "ì˜¤ì—°ìš°ì˜ ì¥ë‚œ", desc: "ì˜¤ì—°ìš°ê°€ ëª°ë˜ ì‹ ë°œëˆì„ ë¬¶ì–´ë†¨ë‹¤.", choices: [{ txt: "í‘¼ë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ê·€ì°®ë‹¤. ë‹¤ìŒ ì „íˆ¬ ì •ì‹ ë ¥ -1" }, { txt: "ë³µìˆ˜í•œë‹¤", res: "GOOD", reward: { type: 'GOLD', val: 150 }, msg: "ì¥ë‚œê°ì„ ëºì—ˆë‹¤. 150ì› íšë“" }] },
            { id: 'ne14', title: "ê¹€ë„ê· ì˜ ë†€ë¦¼", desc: "ìê¾¸ ì˜†ì—ì„œ ê¹ì£½ê±°ë¦°ë‹¤.", choices: [{ txt: "ì°¸ëŠ”ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ì¸ë‚´ì‹¬ì´ ëŠ˜ì—ˆë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ì‘ì§•í•œë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 5 }, msg: "ì‹¸ì› ë‹¤. ì²´ë ¥ -5" }] },
            { id: 'ne15', title: "ë°˜ì¥ ì„ì†Œìœ¨", desc: "ë– ë“¤ë‹¤ê°€ ê±¸ë ¸ë‹¤. ì´ë¦„ì´ ì í ìœ„ê¸°!", choices: [{ txt: "ë‡Œë¬¼(ë§¤ì ë¹µ)", res: "TRADE", reward: { type: 'GOLD_LOSS', cost: 300 }, msg: "300ì›ì„ ì¼ì§€ë§Œ ì´ë¦„ì€ ë¹ ì¡Œë‹¤." }, { txt: "ì‹¹ì‹¹ ë¹ˆë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "í˜¼ë‚¬ë‹¤. ì •ì‹ ë ¥ -1" }] },
            { id: 'ne16', title: "ë¬´ë²•ì ì¥í˜", desc: "ì¥í˜ì´ ë³µë„ë¥¼ ì ê±°í–ˆë‹¤.", choices: [{ txt: "í”¼í•´ê°„ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 5 }, msg: "ì•ˆì „ì´ ìµœê³ . ì²´ë ¥ +5" }, { txt: "ëŒíŒŒí•œë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 8 }, msg: "ë¶€ë”ªí˜”ë‹¤. ì²´ë ¥ -8" }] },
            { id: 'ne17', title: "ë¯¼íŠ¸ì´ˆì½” ì¹˜í‚¨", desc: "ì˜¤ëŠ˜ ê¸‰ì‹ ë©”ë‰´ê°€ ì‹¬ìƒì¹˜ ì•Šë‹¤.", choices: [{ txt: "ë¨¹ëŠ”ë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 5 }, msg: "ì†ì´ ì•ˆ ì¢‹ë‹¤... ì²´ë ¥ -5" }, { txt: "ê±°ë¥¸ë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ë°°ê³ í”„ë‹¤. ì •ì‹ ë ¥ -1" }] },
            { id: 'ne18', title: "ì„ ìƒë‹˜ ë¶€ì¬ì¤‘", desc: "ìˆ˜ì—… ì¢…ì´ ì³¤ëŠ”ë° ì„ ìƒë‹˜ì´ ì•ˆ ì˜¤ì‹ ë‹¤.", choices: [{ txt: "ë¶€ë¥´ëŸ¬ ê°„ë‹¤", res: "GOOD", reward: { type: 'UPGRADE_RANDOM', cost: 0 }, msg: "ì„ ìƒë‹˜ì´ ê³ ë§™ë‹¤ë©° íŒì„ ì£¼ì…¨ë‹¤. ì¹´ë“œ ê°•í™”" }, { txt: "ììŠµí•œë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ê³µë¶€ íš¨ìœ¨ ì—…! ìµœëŒ€ ì •ì‹ ë ¥ +1" }] },
            { id: 'ne19', title: "ìˆ˜í–‰í‰ê°€ í­íƒ„", desc: "ë°€ë¦° ê³¼ì œê°€ ì‚°ë”ë¯¸ë‹¤.", choices: [{ txt: "ë°¤ìƒ˜", res: "BAD", reward: { type: 'HP_LOSS', val: 10 }, msg: "í”¼ê³¤í•˜ë‹¤. ì²´ë ¥ -10" }, { txt: "í¬ê¸°", res: "BAD", reward: { type: 'GOLD_LOSS', cost: 500 }, msg: "ì¥í•™ê¸ˆì„ ë†“ì³¤ë‹¤. 500ì› ì†ì‹¤" }] },
            { id: 'ne20', title: "ì—¼ì •í˜„ Tì˜ ë½‘ê¸°", desc: "ì˜ì–´ ì„ ìƒë‹˜ì´ ë½‘ê¸°íŒì„ ë“¤ê³  ì˜¤ì…¨ë‹¤.", choices: [{ txt: "ë½‘ëŠ”ë‹¤", res: "RANDOM", reward: { type: 'YJH_GACHA' }, msg: "ê²°ê³¼ëŠ”?" }, { txt: "êµ¬ê²½í•œë‹¤", res: "GOOD", reward: { type: 'GET_RARE_CARD' }, msg: "ì°¸ì—¬ìƒìœ¼ë¡œ ì¢‹ì€ ì¹´ë“œë¥¼ ì£¼ì…¨ë‹¤!" }] },
            { id: 'ne21', title: "ì •ì¤€ì„œì˜ êµë‚´ ìˆœì°°", desc: "ì •ì¤€ì„œê°€ êµë‚´ ìˆœì°°ì„ ê°™ì´ í•˜ìê³  í•œë‹¤. ê°™ì´ ê°ˆê¹Œ ë§ê¹Œ?", choices: [{ txt: "ê°™ì´ ê°„ë‹¤", res: "GOOD", reward: { type: 'UPGRADE_RANDOM', cost: 0 }, msg: "ìˆœì°°í•˜ë©° ì£¼ìš´ ì•„ì´í…œìœ¼ë¡œ ì¹´ë“œë¥¼ ê°•í™”í–ˆë‹¤!" }, { txt: "ê±°ì ˆí•œë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ì •ì¤€ì„œê°€ ì‚ì ¸ì„œ ë‹¤ìŒ ì „íˆ¬ ì •ì‹ ë ¥ -1" }] },
            { id: 'ne22', title: "ë°•ê°•ë¯¼ê³¼ ìš´ë™í•˜ê¸°", desc: "ë°•ê°•ë¯¼ì´ í•¨ê»˜ 10km ëŸ¬ë‹ì„ í•˜ìê³  í•œë‹¤. í• ê¹Œ ë§ê¹Œ?", choices: [{ txt: "í•œë‹¤", res: "GOOD", reward: { type: 'MAX_HP', val: 10 }, msg: "ì²´ë ¥ì´ íŠ¼íŠ¼í•´ì¡Œë‹¤! ìµœëŒ€ ì²´ë ¥ +10" }, { txt: "ë„ë§ê°„ë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 5 }, msg: "ì¡í˜€ì„œ ì–µì§€ë¡œ ë›°ì—ˆë‹¤. ì²´ë ¥ -5" }] },
            { id: 'ne23', title: "ë¸Œë¥´ë¥´ ë¸Œë¥´ë¥´ ë°±ì¢…í¬", desc: "ë°±ì¢…í¬ê°€ ìê¸°ì™€ í•¨ê»˜ ë¦´ìŠ¤ë¥¼ ì°ìê³  í•œë‹¤. ì°¸ì—¬í• ê¹Œ ë§ê¹Œ?", choices: [{ txt: "ì°¸ì—¬í•œë‹¤", res: "GOOD", reward: { type: 'GOLD', val: 200 }, msg: "ë¦´ìŠ¤ê°€ ë–¡ìƒí–ˆë‹¤! 200ì› íšë“" }, { txt: "ê±°ì ˆí•œë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ë¶„ìœ„ê¸°ê°€ ì‹¸í•´ì¡Œë‹¤. ì •ì‹ ë ¥ -1" }] },
            { id: 'ne24', title: "ë³µë„ì˜ ê°•ê²½í™˜ ì„ ìƒë‹˜", desc: "ëˆ„êµ°ê°€ê°€ ê°•ê²½í™˜ ì„ ìƒë‹˜ì—ê²Œ í˜¼ë‚˜ê³  ìˆë‹¤. ì´ ê¸¸ë¡œ ê°ˆê¹Œ ëŒì•„ì„œ ê°ˆê¹Œ?", choices: [{ txt: "ì´ ê¸¸ë¡œ ê°„ë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 10 }, msg: "ê´œíˆ ê°™ì´ í˜¼ë‚¬ë‹¤. ì²´ë ¥ -10" }, { txt: "ëŒì•„ì„œ ê°„ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 5 }, msg: "ì•ˆì „í•˜ê²Œ ëŒì•„ê°”ë‹¤. ì²´ë ¥ +5" }] },
            { id: 'ne25', title: "ê°•íƒœì§„ì˜ í˜¸ì¶œ", desc: "ê°•íƒœì§„ì´ ë‚˜ë¥¼ ì€ë°€íˆ ë¶€ë¥¸ë‹¤. 'ì¢‹ì€ ê²Œ ìˆìœ¼ë‹ˆ ë”°ë¼ì™€.'", choices: [{ txt: "ìˆ˜ìƒí•˜ì§€ë§Œ ë”°ë¼ê°„ë‹¤", res: "GOOD", reward: { type: 'MAX_HP', val: 5 }, msg: "ë§›ìˆëŠ” ê°„ì‹ì„ ì–»ì–´ë¨¹ì—ˆë‹¤! ìµœëŒ€ ì²´ë ¥ +5" }, { txt: "ë¬´ì‹œí•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 0 }, msg: "ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ë‹¤." }] },
            { id: 'ne26', title: "ë…ì„œ ê°ìƒë¬¸ ëŒ€íšŒ", desc: "êµë‚´ ë…ì„œ ê°ìƒë¬¸ ëŒ€íšŒê°€ ì—´ë ¸ë‹¤. ë§ˆìŒì˜ ì–‘ì‹ì„ ìŒ“ì„ ê¸°íšŒ?", choices: [{ txt: "ì°¸ê°€í•œë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ìš°ìˆ˜ìƒì„ ë°›ì•˜ë‹¤! ì§€í˜œê°€ ëŠ˜ì–´ë‚œ ê¸°ë¶„. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ê·¸ëƒ¥ ì½ëŠ”ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 10 }, msg: "ì±…ì„ ì½ìœ¼ë©° íœ´ì‹ì„ ì·¨í–ˆë‹¤. ì²´ë ¥ +10" }] },
            { id: 'ne27', title: "êµì‹¤ì— ë–¨ì–´ì§„ ì“°ë ˆê¸°", desc: "ë³µë„ í•œê°€ìš´ë° ëˆ„êµ°ê°€ ì“°ë ˆê¸°ë¥¼ ë²„ë¦¬ê³  ê°”ë‹¤.", choices: [{ txt: "ì¤ëŠ”ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ì°©í•œ ì¼ì„ í•˜ë‹ˆ ê¸°ë¶„ì´ ì¢‹ì•„ì§„ë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ë¬´ì‹œí•œë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ì–‘ì‹¬ì´ ì°”ë¦°ë‹¤... ë‹¤ìŒ ì „íˆ¬ ì •ì‹ ë ¥ -1" }] },
            { id: 'ne28', title: "ì´ë™ë¯¼ì˜ ì—°ì•  ìƒë‹´", desc: "ì´ë™ë¯¼ì´ ì‹¬ê°í•œ í‘œì •ìœ¼ë¡œ ì—°ì•  ìƒë‹´ì„ ìš”ì²­í•œë‹¤.", choices: [{ txt: "ì§„ì§€í•˜ê²Œ ë“£ëŠ”ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ì¸ë‚´ì‹¬ì˜ í•œê³„ë¥¼ ë„˜ì—ˆë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ë†€ë¦°ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 10 }, msg: "í•œì°¸ ì›ƒì—ˆë‹¤. ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ! ì²´ë ¥ +10" }] },
            { id: 'ne29', title: "í•œì¤€ì„œì˜ ë¹„ë°€ ì œì•ˆ", desc: "í•œì¤€ì„œê°€ ìœ„í—˜í•˜ì§€ë§Œ ì†”ê¹ƒí•œ ì œì•ˆì„ í•œë‹¤. 'ì´ê±° í•œ ë²ˆ í•´ë³¼ë˜?'", choices: [{ txt: "ìˆ˜ë½ (ì²´ë ¥ -10)", res: "TRADE", reward: { type: 'TRADE_HP_MAXHP', cost: 10, val: 10 }, msg: "ìœ„í—˜í–ˆì§€ë§Œ ëª¸ì´ íŠ¼íŠ¼í•´ì§„ ê¸°ë¶„ì´ë‹¤! (ì²´ë ¥ -10, ìµœëŒ€ ì²´ë ¥ +10)" }, { txt: "ê±°ì ˆ", res: "GOOD", reward: { type: 'HEAL', val: 0 }, msg: "ì•ˆì „ì´ ìµœê³ ë‹¤." }] },
            { id: 'ne30', title: "ì •í˜„ìš°ì™€ ìˆ˜ì˜ì¥ì—", desc: "ì •í˜„ìš°ê°€ ìˆ˜ì˜ì„ ê°€ë¥´ì³ì¤€ë‹¤ê³  í•œë‹¤. ê°ˆê¹Œ?", choices: [{ txt: "ë°°ìš´ë‹¤", res: "GOOD", reward: { type: 'MAX_HP', val: 5 }, msg: "ì–´í‘¸ì–´í‘¸. íí™œëŸ‰ì´ ëŠ˜ì—ˆë‹¤! ìµœëŒ€ ì²´ë ¥ +5" }, { txt: "ì•ˆ ê°„ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 5 }, msg: "ì§‘ì—ì„œ ì‰¬ì—ˆë‹¤. ì²´ë ¥ +5" }] },
            { id: 'ne31', title: "ê°‘ìê¸° ë“±ì¥í•œ ì²œë„ì˜", desc: "ì²œë„ì˜ì´ ê¸°ê´´í•œ ì¤‘êµ­ ë…¸ë˜ë¥¼ ë¶€ë¥´ë©° ë‚˜íƒ€ë‚¬ë‹¤.", choices: [{ txt: "ê°™ì´ ë¶€ë¥¸ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ì •ì‹  ì„¸ê³„ê°€ í™•ì¥ë˜ì—ˆë‹¤... ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ë„ë§ê°„ë‹¤", res: "BAD", reward: { type: 'START_MANA_DEBUFF', val: 1 }, msg: "ê·€ê°€ ì•„í”„ë‹¤. ë‹¤ìŒ ì „íˆ¬ ì •ì‹ ë ¥ -1" }] },
            { id: 'ne32', title: "ë†êµ¬ í•œíŒ?", desc: "ë‚˜ìœ ë¯¼ì´ ì ì‹¬ ë¨¹ê¸° ì „ì— ë†êµ¬ í•œ íŒ í•˜ìê³  í•œë‹¤.", choices: [{ txt: "í•œë‹¤", res: "GOOD", reward: { type: 'MAX_HP', val: 5 }, msg: "ë•€ì„ í˜ë¦¬ë‹ˆ ìƒì¾Œí•˜ë‹¤. ìµœëŒ€ ì²´ë ¥ +5" }, { txt: "ë°¥ ë¨¹ìœ¼ëŸ¬ ê°„ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 10 }, msg: "ë°¥ì´ ë³´ì•½ì´ë‹¤. ì²´ë ¥ +10" }] },
            { id: 'ne33', title: "ì•Œ ìˆ˜ ì—†ëŠ” ëˆˆë¹›", desc: "í™©ì •ë¯¼ì´ ê°€ë§Œíˆ ë‚˜ë¥¼ ë°”ë¼ë³´ê³  ìˆë‹¤....ë­ì§€?", choices: [{ txt: "ëˆˆì‹¸ì›€ í•œë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ê¸°ì‹¸ì›€ì—ì„œ ì´ê²¼ë‹¤! ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ë¬´ì‹œí•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 0 }, msg: "ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ë‹¤." }] },
            { id: 'ne34', title: "ë³´ê±´ì‹¤ ìƒë‹´", desc: "ë³´ê±´ì‹¤ì— ê°”ë”ë‹ˆ ì„ ìƒë‹˜ì´ ë¹„íƒ€ë¯¼ì„ ì£¼ì‹ ë‹¤. ë¹„íƒ€ë¯¼ì„ ë¨¹ì„ê¹Œ, ìƒë‹´ì„ í• ê¹Œ?", choices: [{ txt: "ë¹„íƒ€ë¯¼ ì„­ì·¨", res: "GOOD", reward: { type: 'MAX_HP', val: 5 }, msg: "ê±´ê°•í•´ì§„ ê¸°ë¶„! ìµœëŒ€ ì²´ë ¥ +5" }, { txt: "ê³ ë¯¼ ìƒë‹´", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ë§ˆìŒì´ í¸ì•ˆí•´ì¡Œë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }] },
            { id: 'ne35', title: "ì¥ê¸° ìë‘", desc: "ì „êµìƒ ì•ì—ì„œ ë…¸ë˜ë¥¼ í•˜ê²Œ ë˜ì—ˆë‹¤....", choices: [{ txt: "ìì‹ ìˆê²Œ ë¶€ë¥¸ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 2 }, msg: "ì—„ì²­ë‚œ í™˜í˜¸! ìì‹ ê° í­ë°œ! ìµœëŒ€ ì •ì‹ ë ¥ +2" }, { txt: "ë„ë§ì¹œë‹¤", res: "BAD", reward: { type: 'HP_LOSS', val: 5 }, msg: "ìª½íŒ”ë¦¼ì— ì´ë¶ˆí‚¥... ì²´ë ¥ -5" }] },
            { id: 'ne36', title: "ë°•ì§€ìš°ì™€ ë‚šì‹œ ë°ì´íŠ¸", desc: "ë°•ì§€ìš°ê°€ ê°™ì´ ë‚šì‹œë¥¼ í•˜ëŸ¬ ê°€ìëŠ”ë°?", choices: [{ txt: "ê°„ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ì„¸ì›”ì„ ë‚šìœ¼ë©° ì¸ë‚´ì‹¬ì„ ê¸¸ë €ë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ê±°ì ˆí•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 0 }, msg: "ì§‘ì´ ìµœê³ ë‹¤." }] },
            { id: 'ne37', title: "ì•ˆí˜•ì§„ ì„ ìƒë‹˜ íŒ¬ í´ëŸ½", desc: "ì•ˆí˜•ì§„ ì„ ìƒë‹˜ì´ ì§€ë‚˜ê°€ì‹ ë‹¤! ì¸ì‚¬ë¥¼ í• ê¹Œ í°ì ˆì„ í• ê¹Œ?", choices: [{ txt: "í°ì ˆì„ ì˜¬ë¦°ë‹¤", res: "GOOD", reward: { type: 'MAX_HP', val: 3 }, msg: "ì„ ìƒë‹˜ì´ ê»„ê»„ ì›ƒìœ¼ë©° ì‚¬íƒ•ì„ ì£¼ì…¨ë‹¤. ìµœëŒ€ ì²´ë ¥ +3" }, { txt: "ê·¸ëƒ¥ ì¸ì‚¬í•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 5 }, msg: "ë°˜ê°‘ê²Œ ë°›ì•„ì£¼ì…¨ë‹¤. ì²´ë ¥ +5" }] },
            { id: 'ne38', title: "ì„œìœ¤ìš°ì™€ ì£¼ì§“ìˆ˜ ëŒ€ê²°", desc: "ì„œìœ¤ìš°ê°€ ì£¼ì§“ìˆ˜ ê¸°ìˆ ì„ ì‚¬ìš©í•´ ë³´ê³  ì‹¶ë‹¤ëŠ”ë°?", choices: [{ txt: "ëŒ€ë ¨í•´ì¤€ë‹¤", res: "TRADE", reward: { type: 'TRADE_HP_MAXHP', cost: 10, val: 10 }, msg: "ì˜¨ëª¸ì´ ì‘¤ì‹œì§€ë§Œ ë§·ì§‘ì´ ëŠ˜ì—ˆë‹¤. (ì²´ë ¥ -10, ìµœëŒ€ ì²´ë ¥ +10)" }, { txt: "ë„ë§ê°„ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 0 }, msg: "ì‚´ì•˜ë‹¤." }] },
            { id: 'ne39', title: "ì‹œí—˜ ì¶œì œ ê¸°ê°„", desc: "êµë¬´ì‹¤ì— ë“¤ì–´ê°€ê³  ì‹¶ì€ë° ì‹œí—˜ ê¸°ê°„ì´ë¼ ëª» ë“¤ì–´ê°„ë‹¤ê³  ì í˜€ ìˆë‹¤.", choices: [{ txt: "ëª°ë˜ ë“¤ì–´ê°„ë‹¤", res: "GOOD", reward: { type: 'UPGRADE_RANDOM', cost: 0 }, msg: "ì‹œí—˜ ì •ë³´ë¥¼ ì—¿ë´¤ë‹¤! (ì¹´ë“œ 1ì¥ ê°•í™”)" }, { txt: "ëŒì•„ê°„ë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 0 }, msg: "ì–‘ì‹¬ì„ ì§€ì¼°ë‹¤." }] },
            { id: 'ne40', title: "ì‹ ì¤€í¬ì˜ êµë¬´ì‹¤ íˆ¬ì–´", desc: "ì‹ ì¤€í¬ê°€ êµë¬´ì‹¤ì„ í•œë²ˆ êµ¬ê²½í•˜ëŸ¬ ê°€ìê³  í•œë‹¤. ë‚´ê°€ ì™œ?", choices: [{ txt: "ë”°ë¼ê°„ë‹¤", res: "GOOD", reward: { type: 'MAX_MANA', val: 1 }, msg: "ì„ ìƒë‹˜ë“¤ì˜ ê°„ì‹ì„ ì–»ì–´ë¨¹ì—ˆë‹¤. ìµœëŒ€ ì •ì‹ ë ¥ +1" }, { txt: "ê±°ì ˆí•œë‹¤", res: "GOOD", reward: { type: 'HEAL', val: 5 }, msg: "í”¼ê³¤í•˜ë‹¤. ì‰¬ì." }] },
        ];

        const shuffle = (array) => array.sort(() => Math.random() - 0.5);

        const getRandomCard = (activeSubjects, deck, rarityWeights, includeBasic = true, excludeNames = []) => {
            const rand = Math.random() * 100;
            let selectedRarity = 'COMMON';
            if (rand < rarityWeights.COMMON) selectedRarity = 'COMMON';
            else if (rand < rarityWeights.COMMON + rarityWeights.SPECIAL) selectedRarity = 'SPECIAL';
            else if (rand < rarityWeights.COMMON + rarityWeights.SPECIAL + rarityWeights.RARE) selectedRarity = 'RARE';
            else selectedRarity = 'LEGEND';

            let pool = CARD_DATABASE.filter(c => {
                const isSubjectMatch = (c.subject === 'BASIC' && includeBasic) || activeSubjects.includes(c.subject);
                return isSubjectMatch && c.rarity === selectedRarity && !excludeNames.includes(c.name);
            });
            
            if (selectedRarity === 'RARE' || selectedRarity === 'LEGEND') {
                pool = pool.filter(c => {
                if (c.subject === 'BASIC') return true;
                return deck.some(dc => dc.subject === c.subject);
                });
                if (pool.length === 0) {
                pool = CARD_DATABASE.filter(c => (c.subject === 'BASIC' || activeSubjects.includes(c.subject)) && c.rarity === 'SPECIAL' && !excludeNames.includes(c.name));
                }
            }

            if (pool.length === 0) pool = CARD_DATABASE.filter(c => c.subject === 'BASIC' && c.rarity === 'COMMON' && !excludeNames.includes(c.name));
            if (pool.length === 0) pool = CARD_DATABASE.filter(c => c.subject === 'BASIC');

            const selected = pool[Math.floor(Math.random() * pool.length)];
            return { ...selected, uid: Math.random().toString(36).substr(2, 9), upgrades: 0 };
        };

        const upgradeCard = (card, amount = 2) => {
            if (card.type === 'SKILL') {
                if ((card.upgrades || 0) >= 3) return card;
                let newCost = card.cost;
                let newDesc = card.desc;
                let newExhaust = card.exhaust;
                if (card.exhaust) {
                    newExhaust = false;
                    newDesc = newDesc.replace('(ì†Œë©¸)', '');
                } else {
                    newCost = Math.max(0, card.cost - 1);
                }
                return { ...card, cost: newCost, desc: newDesc, exhaust: newExhaust, upgrades: (card.upgrades || 0) + 1 };
            }
            if ((card.upgrades || 0) >= 10) return card;
            return { ...card, val: (card.val || 0) + amount, upgrades: (card.upgrades || 0) + 1 };
        };

        const Card = ({ card, onClick, isSelected, gameStats }) => {
            const subjectInfo = SUBJECTS[card.subject] || SUBJECTS.BASIC;
            let actionEmoji = 'âš”ï¸';
            if (card.type === 'DEFENSE') actionEmoji = 'ğŸ›¡ï¸';
            if (card.type === 'SKILL') actionEmoji = 'ğŸ”®';

            const calculateDynamicValue = () => {
                if (card.type !== 'ATTACK' && card.type !== 'DEFENSE') return null;
                
                let val = card.val;
                if (card.type === 'ATTACK') {
                    if (card.name === 'íœ ì°Œë¥´ê¸°' && gameStats?.hasPenRelic) val += 10;
                    val += (gameStats?.strength || 0);
                    let mult = (gameStats?.damageMultiplier || 1) * (gameStats?.nextAttackMult || 1);
                    if (card.effect === 'LOW_HP_BONUS' && gameStats?.isLowHp) mult *= 2;
                    val = Math.floor(val * mult);
                }
                return val;
            };

            const dynamicVal = calculateDynamicValue();
            const showDynamic = dynamicVal !== null && dynamicVal !== card.val;

            return (
                <div 
                    onClick={() => onClick && onClick(card)}
                    className={`relative w-32 h-48 rounded-lg border-2 flex flex-col p-2 cursor-pointer transition-transform hover:scale-110 shadow-md select-none bg-white
                    ${RARITY[card.rarity].color} 
                    ${isSelected ? 'ring-4 ring-red-500 -translate-y-4' : ''}
                    ${card.exhaust ? 'card-exhaust' : ''}
                    `}
                >
                    <div className="text-xs font-bold flex justify-between">
                        <span className="font-extrabold">{subjectInfo.name}</span>
                        <span className="bg-white/50 px-1 rounded">{card.cost} ì½”ìŠ¤íŠ¸</span>
                    </div>
                    <div className="text-sm font-bold text-center mt-2 break-keep leading-tight text-black">
                        {card.name} 
                        {card.upgrades > 0 && <span className="text-red-500 text-xs ml-1">(+{card.upgrades})</span>}
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-center gap-1 bg-white/20 rounded-lg my-1">
                        <div className="flex gap-2 text-3xl">
                            <span>{subjectInfo.emoji}</span>
                            <span>{actionEmoji}</span>
                        </div>
                        {(card.type === 'ATTACK' || card.type === 'DEFENSE') && (
                            <span className={`text-xl font-black drop-shadow-sm ${showDynamic ? 'text-green-600' : 'text-slate-800'}`}>
                                {dynamicVal !== null ? dynamicVal : card.val}
                            </span>
                        )}
                    </div>
                    <div className="text-xs text-center bg-white/40 p-1 rounded min-h-[40px] flex items-center justify-center break-keep text-slate-900 leading-none">{card.desc}</div>
                    <div className="absolute bottom-1 right-2 text-[10px] opacity-70 text-black font-bold">{RARITY[card.rarity].name}</div>
                </div>
            );
        };

        const SchoolAscent = () => {
            const [gameState, setGameState] = useState('MENU');
            const [hp, setHp] = useState(80);
            const [maxHp, setMaxHp] = useState(80);
            const [mental, setMental] = useState(5);
            const [maxMental, setMaxMental] = useState(5);
            const [gold, setGold] = useState(0);
            const [deck, setDeck] = useState([]);
            const [activeSubjects, setActiveSubjects] = useState([]);
            const [selectedSubjects, setSelectedSubjects] = useState([]); 
            const [artifacts, setArtifacts] = useState([]); 
            const [bossPlan, setBossPlan] = useState({}); 

            const [stage, setStage] = useState(1);
            const [stageType, setStageType] = useState('NORMAL');
            
            const [hand, setHand] = useState([]);
            const [drawPile, setDrawPile] = useState([]);
            const [discardPile, setDiscardPile] = useState([]);
            const [exhaustPile, setExhaustPile] = useState([]); 
            const [turn, setTurn] = useState(1);
            const [selectedCard, setSelectedCard] = useState(null);
            const [playerBlock, setPlayerBlock] = useState(0);
            const [lastCardSubject, setLastCardSubject] = useState(null);
            const [mathComboCount, setMathComboCount] = useState(0);
            
            const [turnBlockBuff, setTurnBlockBuff] = useState(0);
            const [persistentBlockBonus, setPersistentBlockBonus] = useState(0); 
            const [damageMultiplier, setDamageMultiplier] = useState(1);
            const [isImmune, setIsImmune] = useState(false);
            const [playerStrength, setPlayerStrength] = useState(0); 
            const [permStrength, setPermStrength] = useState(0);
            const [nextAttackMult, setNextAttackMult] = useState(1); 
            const [dodgeStacks, setDodgeStacks] = useState(0);

            const [enemies, setEnemies] = useState([]);
            const [combatLog, setCombatLog] = useState([]);

            const [currentEvent, setCurrentEvent] = useState(null);
            const [eventResult, setEventResult] = useState(null); 
            const [encounteredEventIds, setEncounteredEventIds] = useState([]);
            const [teacherEvent, setTeacherEvent] = useState(null); 
            const [combatsSinceLastEvent, setCombatsSinceLastEvent] = useState(0); 

            const [tempSelected, setTempSelected] = useState([]); 
            const [shopCards, setShopCards] = useState([]);
            const [rewardCards, setRewardCards] = useState([]); 
            const [relicRewards, setRelicRewards] = useState([]); 
            const [tempManaDebuff, setTempManaDebuff] = useState(0); 
            const [rewardTeacher, setRewardTeacher] = useState(null);
            const [shakeTarget, setShakeTarget] = useState(null); 
            // [íƒ€ê²©ê° ì‹œìŠ¤í…œ] ë°ë¯¸ì§€ í°íŠ¸ ë° í”¼ê²© íš¨ê³¼
            const [dmgOverlays, setDmgOverlays] = useState([]); // { id, targetId, val, type }
            const [redFlash, setRedFlash] = useState(false);
            const [isPlayerStunned, setIsPlayerStunned] = useState(false); // í”Œë ˆì´ì–´ ê¸°ì ˆ ìƒíƒœ
            
            const [isGameCleared, setIsGameCleared] = useState(false); // 100ì¸µ í´ë¦¬ì–´ ì—¬ë¶€ (2íšŒì°¨ í•´ê¸ˆìš©)

            // ê²Œì„ ì‹œì‘ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í´ë¦¬ì–´ ê¸°ë¡ í™•ì¸
            useEffect(() => {
                const cleared = localStorage.getItem('daesong_clear_status');
                if (cleared === 'true') setIsGameCleared(true);
            }, []);

            const showDamage = (targetId, val) => {
                let type = 'NORMAL';
                if (val >= 45) type = 'SUPER';
                else if (val >= 25) type = 'CRIT';
                
                const newOverlay = { id: Date.now() + Math.random(), targetId, val, type };
                setDmgOverlays(prev => [...prev, newOverlay]);
                
                // 1ì´ˆ ë’¤ì— í…ìŠ¤íŠ¸ ì‚¬ë¼ì§ (ë©”ëª¨ë¦¬ ì •ë¦¬)
                setTimeout(() => {
                    setDmgOverlays(prev => prev.filter(o => o.id !== newOverlay.id));
                }, 1000);
            };

            // --- BGM Logic ---
            const audioRef = useRef(null);
            const [isMuted, setIsMuted] = useState(false);
            const [highScores, setHighScores] = useState([]);
            const [playerName, setPlayerName] = useState("");

            // [ìˆ˜ì •] ì‹¤ì‹œê°„ ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸° (Firebase ì„œë²„ ì—°ë™)
            useEffect(() => {
                if (gameState === 'RANKING' && db) {
                    const unsubscribe = db.collection("leaderboard")
                        .orderBy("score", "desc") // ì ìˆ˜ ë†’ì€ ìˆœ
                        .limit(50) // 50ëª…ê¹Œì§€ë§Œ
                        .onSnapshot((snapshot) => {
                            // ëˆ„êµ°ê°€ ì ìˆ˜ ë“±ë¡í•˜ë©´ ë‚´ í™”ë©´ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤!
                            const scores = snapshot.docs.map(doc => doc.data());
                            setHighScores(scores.slice(0, 10)); // í™”ë©´ì—” Top 10 í‘œì‹œ
                        }, (error) => {
                            console.error("ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:", error);
                        });
                    return () => unsubscribe();
                }
            }, [gameState]);

            // [ìˆ˜ì •] ë­í‚¹ ì„œë²„ì— ì €ì¥í•˜ê¸°
            const saveScore = () => {
                if (!playerName.trim()) return;

                // ì ìˆ˜ ê³„ì‚° ë¡œì§ (V1.8 ìœ ì§€)
                let finalScore = stage * 100 + hp * 10 + maxMental * 500 + gold - deck.length * 50;
                if (stage >= 100) {
                    finalScore += 10000;
                    // 100ì¸µ í´ë¦¬ì–´ ì‹œ ë‚´ ì»´í“¨í„°ì— 'íˆë“  í•´ê¸ˆ' ë„ì¥ ì°ê¸°
                    localStorage.setItem('daesong_clear_status', 'true');
                    setIsGameCleared(true);
                }
                finalScore = Math.max(0, finalScore);

                // ì„œë²„ë¡œ ì „ì†¡
                if (db) {
                    db.collection("leaderboard").add({
                        name: playerName,
                        stage: stage,
                        score: finalScore,
                        date: new Date().toLocaleDateString(),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        alert("ì „ì„¤ì˜ ì „ë‹¹ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
                        playRetroSound('click');
                        setGameState('RANKING');
                    }).catch(err => alert("ì €ì¥ ì‹¤íŒ¨: " + err));
                } else {
                    alert("ì„œë²„ì™€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                }
            };

            const copyScore = () => {
                const text = `ğŸ† ëŒ€ì†¡ ë“±ë°˜ ë„ì „!\n${playerName || 'ì´ë¦„ì—†ìŒ'}ë‹˜ì´ ${stage}êµì‹œê¹Œì§€ ìƒì¡´í–ˆìŠµë‹ˆë‹¤.\n#ëŒ€ì†¡ë“±ë°˜ #100êµì‹œì˜ì „ì„¤`;
                navigator.clipboard.writeText(text).then(() => alert("ì„±ì í‘œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹œêµ¬ë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”."));
                playRetroSound('click');
            };

       // [ìµœì¢…] ë“œë¡­ë°•ìŠ¤ ì „ìš© BGM ì¬ìƒê¸° (BGM ëŠê¹€ ë°©ì§€ + ë³´ìŠ¤ë³„ ê°œë³„ BGM ì ìš©ë¨)
            useEffect(() => {
                if (!audioRef.current) {
                    audioRef.current = new Audio();
                    audioRef.current.onerror = (e) => {
                        console.error("ğŸš« ì¬ìƒ ì‹¤íŒ¨! ë§í¬ë¥¼ í™•ì¸í•˜ì„¸ìš”:", audioRef.current.src);
                    };
                }
                const audio = audioRef.current;
                
                let targetUrl = '';

                // 1. ë©”ë‰´ ë° ì—”ë”© í™”ë©´ (ìµœìš°ì„  ìˆœìœ„)
                if (gameState === 'MENU' || gameState === 'SELECT_SUBJECTS' || gameState === 'RANKING') {
                    targetUrl = BGM_IDS.MENU;
                } 
                else if (gameState === 'VICTORY') {
                    targetUrl = BGM_IDS.VICTORY;
                } 
                else if (gameState === 'GAME_OVER') {
                    targetUrl = BGM_IDS.GAMEOVER;
                }
                // 2. ë³´ìŠ¤ì „ (ì „íˆ¬ ì¤‘ì¼ ë•Œë§Œ ê°œë³„ ë³´ìŠ¤ ìŒì•… ì¬ìƒ)
                else if (gameState === 'COMBAT') {
                    if (stage === 20) targetUrl = BGM_IDS.BOSS_20;
                    else if (stage === 40) targetUrl = BGM_IDS.BOSS_40;
                    else if (stage === 60) targetUrl = BGM_IDS.BOSS_60;
                    else if (stage === 80) targetUrl = BGM_IDS.BOSS_80;
                    else if (stage === 98) targetUrl = BGM_IDS.BOSS_98;
                    else if (stage === 99) targetUrl = BGM_IDS.BOSS_99;
                    else if (stage === 100) targetUrl = BGM_IDS.BOSS_FINAL;
                    else {
                        // ì¼ë°˜ ì „íˆ¬ (1~50: Normal 1, 51~97: Normal 2)
                        if (stage <= 50) targetUrl = BGM_IDS.NORMAL_1;
                        else targetUrl = BGM_IDS.NORMAL_2;
                    }
                }
                // 3. ë¹„ì „íˆ¬ êµ¬ê°„ (ìƒì , ì´ë²¤íŠ¸, ê¸‰ì‹ ë“±) - ëŠê¹€ ì—†ì´ ì¼ë°˜ BGM ìœ ì§€
                else {
                    if (stage <= 50) {
                        targetUrl = BGM_IDS.NORMAL_1; 
                    } else {
                        targetUrl = BGM_IDS.NORMAL_2; 
                    }
                }

                // 4. ìŒì•… ë³€ê²½ì´ í•„ìš”í•  ë•Œë§Œ ì¬ìƒ
                if (targetUrl && audio.src !== targetUrl) {
                    console.log("ğŸµ ìŒì•… ë³€ê²½:", targetUrl);
                    audio.src = targetUrl;
                    audio.loop = (gameState !== 'VICTORY' && gameState !== 'GAME_OVER');
                    audio.volume = 0.5;
                    
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.warn("âš ï¸ ìë™ ì¬ìƒ ì°¨ë‹¨ë¨ (ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í•„ìš”)");
                        });
                    }
                } else if (!targetUrl) {
                    audio.pause();
                }
            }, [gameState, stageType, stage]);

            const toggleMute = () => {
                if (audioRef.current) {
                    audioRef.current.muted = !audioRef.current.muted;
                    setIsMuted(audioRef.current.muted);
                }
                playRetroSound('click');
            };

            const triggerShake = (target) => {
                setShakeTarget(target);
                setTimeout(() => setShakeTarget(null), 500);
            };

            const startGame = () => {
                // Resume AudioContext if it was suspended (browser policy)
                if (window.AudioContext || window.webkitAudioContext) {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    if (ctx.state === 'suspended') ctx.resume();
                }
                playRetroSound('click');
                setHp(80); setMaxHp(80); setMental(5); setMaxMental(5); setGold(100); setStage(1);
                setArtifacts([]); setPermStrength(0); setDeck([]); setSelectedSubjects([]);
                setEncounteredEventIds([]); setCombatsSinceLastEvent(0);
                setGameState('SELECT_SUBJECTS'); 
            };

            const confirmSubjects = () => {
                playRetroSound('click');
                setActiveSubjects(selectedSubjects);
                const basicAttacks = Array(3).fill(null).map(() => ({ ...CARD_DATABASE.find(c => c.name === 'íœ ì°Œë¥´ê¸°'), uid: Math.random().toString(36).substr(2, 9), upgrades: 0 }));
                const basicDefenses = Array(3).fill(null).map(() => ({ ...CARD_DATABASE.find(c => c.name === 'êµê³¼ì„œ ë°©ì–´'), uid: Math.random().toString(36).substr(2, 9), upgrades: 0 }));
                const basicSpecial = [{ ...CARD_DATABASE.find(c => c.name === 'í•„í†µ í›„ë ¤ì¹˜ê¸°'), uid: Math.random().toString(36).substr(2, 9), upgrades: 0 }];
                const initialDeck = [...basicAttacks, ...basicDefenses, ...basicSpecial];
                setDeck(initialDeck);
                const shuffledSubjects = shuffle([...selectedSubjects]);
                const bossSchedule = { 20: shuffledSubjects[0], 40: shuffledSubjects[1], 60: shuffledSubjects[2], 80: [shuffledSubjects[3], shuffledSubjects[4]] };
                setBossPlan(bossSchedule);
                setGameState('MAP');
                generateStage(1, selectedSubjects, initialDeck);
            };

            const generateStage = (stageNum, subjects = activeSubjects, currentDeck = deck, currentArtifacts = artifacts) => {
                setStage(stageNum);
                setTempSelected([]); 
                if (stageNum > 1 && stageNum % 10 === 1) { startTeacherEvent(); return; }
                let type = 'NORMAL';
                if ([20, 40, 60, 80, 98, 99, 100].includes(stageNum)) type = 'BOSS';
                else if (stageNum === 97) type = 'SHOP';
                else if (stageNum % 20 === 10) type = 'DANGER'; 
                else if (stageNum > 4 && stageNum % 10 === 5) type = 'LUNCH';
                else if (stageNum > 4 && stageNum % 10 === 8) type = 'SHOP';
                else {
                    if (combatsSinceLastEvent > 0 && Math.random() < 0.35) type = 'EVENT';
                    else if (combatsSinceLastEvent >= 2) type = 'EVENT';
                    else type = 'NORMAL';
                }
                setStageType(type);
                if (type === 'NORMAL' || type === 'DANGER' || type === 'BOSS') {
                    setCombatsSinceLastEvent(prev => prev + 1); 
                    startCombat(stageNum, type, currentDeck, currentArtifacts);
                } else if (type === 'EVENT') {
                    setCombatsSinceLastEvent(0); 
                    startEvent();
                } else if (type === 'SHOP') {
                    startShop(subjects);
                } else if (type === 'LUNCH') {
                    setGameState('LUNCH');
                }
            };

           const getBossIntent = (enemy, turnCount, stageNum) => {
                // 100êµì‹œ: ëŒ€ê¸° ì‚­ì œ, ê´‘ì—­ê¸° ì¶”ê°€
                if (stageNum === 100) {
                    const cycle = turnCount % 4;
                    if (cycle === 1) return 'IRON_WALL'; 
                    if (cycle === 2) return 'MANA_BURN'; 
                    if (cycle === 3) return 'MULTI_ATTACK'; // ì—°ì† ê³µê²©
                    return 'BIG_ATTACK';
                }
                // 99êµì‹œ: êµì¥ ë²„í”„ë§Œ ì“°ëŠ” ë²„ê·¸ ìˆ˜ì •
                if (stageNum === 99) {
                    if (enemy.id === 1) { 
                        const cycle = turnCount % 3;
                        if (cycle === 1) return 'BUFF';
                        if (cycle === 2) return 'BIG_ATTACK';
                        return 'IRON_WALL';
                    }
                    return 'ATTACK';
                }
                // 98êµì‹œ: ê³µê²© ë¹ˆë„ ìƒí–¥
                if (stageNum === 98) {
                    if (turnCount % 3 === 0) return 'BIG_ATTACK'; 
                    return 'ATTACK'; 
                }
                
                const subj = enemy.subject;
                if (!subj) return 'ATTACK'; 

                // ìˆ˜í•™: 3í„´ ì£¼ê¸°ë¡œ ë„ˆí”„
                if (subj === 'MATH') {
                    const cycle = turnCount % 3;
                    if (cycle === 1) return 'BUFF';
                    if (cycle === 2) return 'ATTACK';
                    return 'BIG_ATTACK';
                }
                // ì²´ìœ¡: 3í„´ ì£¼ê¸°ë¡œ ë„ˆí”„
                if (subj === 'PE') {
                    const cycle = turnCount % 3;
                    if (cycle === 1) return 'ATTACK';
                    if (cycle === 2) return 'BUFF';
                    return 'BIG_ATTACK';
                }
                // ê³¼í•™: í­ë°œ ê³µê²© ì¶”ê°€ (ìƒí–¥)
                if (subj === 'SCIENCE') {
                    const cycle = turnCount % 3;
                    if (cycle === 1) return 'DEBUFF';
                    if (cycle === 2) return 'ATTACK';
                    return 'BIG_ATTACK';
                }
                // ì‚¬íšŒ: 2ì—°íƒ€ ê³µê²© ì¶”ê°€ (ìƒí–¥)
                if (subj === 'SOCIAL') {
                    const cycle = turnCount % 3;
                    if (cycle === 1) return 'SUPER_DEFEND';
                    if (cycle === 2) return 'BUFF';
                    return 'MULTI_ATTACK';
                }
                // ìŒì•…/ë¯¸ìˆ : ê¸°ì ˆ ê³µê²© ì¶”ê°€ (ë³€ìˆ˜ ì°½ì¶œ)
                if (subj === 'MUSIC' || subj === 'ART') {
                    const rand = Math.random();
                    if (rand < 0.3) return 'STUN_ATTACK';
                    if (rand < 0.6) return 'DEBUFF';
                    return 'MULTI_ATTACK';
                }
                // ì—­ì‚¬: ìœ ì§€
                if (subj === 'HISTORY') {
                    if (enemy.hp < enemy.maxHp * 0.4) return 'HEAL';
                    return 'MULTI_ATTACK';
                }

                if (Math.random() < 0.3) return 'BUFF';
                return 'ATTACK';
            };

            const startCombat = (stg, type, currentDeck, currentArtifacts = artifacts) => {
                setGameState('COMBAT');
                setTurn(1);
                
                // ìœ ë¬¼ íš¨ê³¼: ì‹œì‘ ë§ˆë‚˜
                const startManaRelic = currentArtifacts.find(r => r.effect === 'START_MANA');
                setMental(maxMental - tempManaDebuff + (startManaRelic ? startManaRelic.val : 0)); 
                setTempManaDebuff(0); 
                
                // ìœ ë¬¼ íš¨ê³¼: ì‹œì‘ ë°©ì–´ë„
                const startBlockRelic = currentArtifacts.find(r => r.effect === 'START_BLOCK');
                setPlayerBlock(startBlockRelic ? startBlockRelic.val : 0);
                
                setTurnBlockBuff(0);
                setPersistentBlockBonus(0); 
                setDamageMultiplier(1);
                setIsImmune(false);
                setIsPlayerStunned(false); // [í•„ìˆ˜] ê¸°ì ˆ ì´ˆê¸°í™”
                
                // [ì‹ ê·œ] ìœ ë¬¼ íš¨ê³¼: ì„ ë„ë¶€ ëª…ì°° (ì‹œì‘ í˜)
                const startStrengthRelic = currentArtifacts.find(r => r.effect === 'START_STRENGTH');
                setPlayerStrength(permStrength + (startStrengthRelic ? startStrengthRelic.val : 0)); 
                
                setNextAttackMult(1);
                setDodgeStacks(0);
                setDrawPile(shuffle([...(currentDeck && currentDeck.length > 0 ? currentDeck : deck)]));
                setHand([]); setDiscardPile([]); setExhaustPile([]);
                setCombatLog(["ì „íˆ¬ ì‹œì‘!"]);
                setLastCardSubject(null);
                setMathComboCount(0);
                
                let newEnemies = [];
                let difficultyMult = stg <= 10 ? 0.5 + (stg * 0.02) : 0.8 + ((stg - 10) * 0.025);
                
                // ë³´ìŠ¤ ë° ì  ìƒì„± ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
                if (type === 'BOSS') {
                    if (stg === 100) newEnemies.push({ id: 0, name: 'ì²œì°½ìˆ˜ êµìœ¡ê°', emoji: 'ğŸ‘‘', maxHp: 2000, hp: 2000, dmg: 35, block: 0, status: {}, intent: 'ATTACK' });
                    else if (stg === 99) { 
                        newEnemies.push({ id: 0, name: 'êµê° ì„ ìƒë‹˜', emoji: 'ğŸ§', maxHp: 800, hp: 800, dmg: 25, block: 0, status: {}, intent: 'ATTACK' }); 
                        newEnemies.push({ id: 1, name: 'êµì¥ ì„ ìƒë‹˜', emoji: 'ğŸ¥¸', maxHp: 1000, hp: 1000, dmg: 22, block: 0, status: {}, intent: 'BUFF' }); 
                    }
                    else if (stg === 98) newEnemies.push({ id: 0, name: 'í•™ë…„ë¶€ì¥ ì—¼ì •í˜„', emoji: 'ğŸ‘¨â€ğŸ«', subject: 'ENGLISH', maxHp: 500, hp: 500, dmg: 18, block: 0, status: {}, intent: 'DEFEND' });
                    else if (stg === 80) { bossPlan[80].forEach((subjKey, idx) => { const info = SUBJECTS[subjKey]; newEnemies.push({ id: idx, name: `${info.teacher} ì„ ìƒë‹˜`, emoji: info.teacherEmoji, subject: subjKey, maxHp: Math.floor(180 * difficultyMult), hp: Math.floor(180 * difficultyMult), dmg: Math.floor(10 * difficultyMult), block: 0, status: {}, intent: 'ATTACK' }); }); }
                    else { const subjKey = bossPlan[stg]; const info = SUBJECTS[subjKey]; newEnemies.push({ id: 0, name: `${info.teacher} ì„ ìƒë‹˜`, emoji: info.teacherEmoji, subject: subjKey, maxHp: Math.floor(200 * difficultyMult), hp: Math.floor(200 * difficultyMult), dmg: Math.floor(12 * difficultyMult), block: 0, status: {}, intent: 'ATTACK' }); }
                } else {
                    const enemyPool = Math.random() < 0.5 ? ENEMIES.IN_SCHOOL : ENEMIES.OUT_SCHOOL;
                    const count = (Math.random() > 0.7) ? 1 : Math.floor(Math.random() * 2) + 1;
                    for(let i=0; i<count; i++) {
                        const template = enemyPool[Math.floor(Math.random() * enemyPool.length)];
                        const maxH = Math.floor(template.hp * difficultyMult * (type==='DANGER' ? 1.5 : 1));
                        newEnemies.push({ id: i, name: template.name + (type==='DANGER' ? ' (ìœ„í—˜)' : ''), emoji: template.emoji, maxHp: maxH, hp: maxH, dmg: Math.max(1, Math.floor(template.dmg * difficultyMult)), block: 0, intent: 'ATTACK', status: {} });
                    }
                }
                const startWeakRelic = currentArtifacts.find(r => r.effect === 'START_WEAK');
                if (startWeakRelic) newEnemies = newEnemies.map(e => ({...e, status: {...e.status, weak: startWeakRelic.val}}));
                setEnemies(newEnemies);
                setTimeout(() => drawCards(5, shuffle([...(currentDeck || deck)]), [], 0), 100);
            };

            const drawCards = (count, currentDraw, currentDiscard, currentHandSize) => {
                let newDraw = [...currentDraw];
                let newDiscard = [...currentDiscard];
                let drawn = [];
                for(let i=0; i<count; i++) {
                    if (newDraw.length === 0) {
                        if (newDiscard.length === 0) break;
                        newDraw = shuffle(newDiscard);
                        newDiscard = [];
                    }
                    drawn.push(newDraw.pop());
                }
                setDrawPile(newDraw);
                setDiscardPile(newDiscard);
                setHand(prev => [...prev, ...drawn]);
            };

            const playCard = (card, targetId) => {
                // [ì•ˆì „ì¥ì¹˜] ê¸°ì ˆ ìƒíƒœë©´ ì¹´ë“œ ì‚¬ìš© ë¶ˆê°€
                if (isPlayerStunned) {
                    setCombatLog(prev => ["ğŸ’« ê¸°ì ˆ ìƒíƒœì…ë‹ˆë‹¤! ì´ë²ˆ í„´ì€ ì‰´ ìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤.", ...prev]);
                    triggerShake('player');
                    return;
                }

                // 1. ì½”ìŠ¤íŠ¸ ë° íƒ€ê²Ÿ í™•ì¸
                if (mental < card.cost) { setCombatLog(prev => [`ğŸš« ì •ì‹ ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!`, ...prev]); triggerShake('player'); return; }
                
                const needsTarget = (card.type === 'ATTACK' || ['STUN', 'POISON', 'WEAK', 'DISPEL', 'VULNERABLE'].some(e => card.effect?.includes(e))) && !['AOE_ATTACK', 'AOE_STUN_ATTACK', 'AOE_DMG_POISON'].includes(card.effect);
                
                if (needsTarget && targetId === null) { setCombatLog(prev => [`ğŸ¯ ëŒ€ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.`, ...prev]); return; }
                
                // 2. ìì› ì†Œëª¨ ë° ì¹´ë“œ ì œì¶œ
                setMental(prev => prev - card.cost);
                setHand(prev => prev.filter(c => c.uid !== card.uid));
                
                // ì¹´ë“œ ì„±ì¥(Scaling) ì²˜ë¦¬ (ë‹¤ìŒ ì‚¬ìš©ì„ ìœ„í•´ ê°•í™”)
                let processedCard = { ...card };
                if (card.effect === 'SCALING_ON_USE') { 
                    processedCard.val += card.effectVal; 
                    setCombatLog(prev => [`ğŸ“ˆ ${card.name} ìˆ™ë ¨ë„ ì¦ê°€! (${processedCard.val})`, ...prev]); 
                }

                if (processedCard.exhaust) setExhaustPile(prev => [...prev, processedCard]); else setDiscardPile(prev => [...prev, processedCard]);
                setSelectedCard(null);

                // ================================================================
                // ğŸ› ï¸ [í•µì‹¬ ìˆ˜ì •] ë°ë¯¸ì§€ í†µí•© ê³„ì‚° ë¡œì§ (ìˆœì„œ ë³´ì¥)
                // ================================================================
                
                // (1) ê¸°ë³¸ ë°ë¯¸ì§€ ì„¤ì • (ê°•í™”ëœ ìˆ˜ì¹˜ card.val ë°˜ì˜)
                let baseDmg = card.val || 0; 

                // íŠ¹ìˆ˜ ê³µì‹ ì ìš©
                if (card.effect === 'MATH_MULTIPLY') { // ë¯¸ì ë¶„: ê³ ì •ê°’ 15 ëŒ€ì‹  card.val ì‚¬ìš© (ê°•í™” ì ìš©ë¨)
                    baseDmg = baseDmg * Math.pow(2, mathComboCount);
                } else if (card.effect === 'MANA_BURN_ATTACK') { // ìŠ¤í¬ë˜ì¹˜ ì•„íŠ¸
                    baseDmg = mental * 15; // (ì£¼ì˜: mental ì°¨ê°ì€ ë’¤ì—ì„œ ì²˜ë¦¬)
                } else if (card.effect === 'BODY_SLAM') { // ë³¸ë¬¸ í•´ì„
                    baseDmg = playerBlock;
                }

                // (2) ì¡°ê±´ë¶€ ë³´ë„ˆìŠ¤ í•©ì‚°
                if (card.name === 'íœ ì°Œë¥´ê¸°' && artifacts.some(r => r.effect === 'PEN_BUFF')) baseDmg += 10;
                if (card.subject === 'MATH' && card.effect === 'MATH_COMBO' && lastCardSubject === 'MATH') baseDmg += card.effectVal; // í”¼íƒ€ê³ ë¼ìŠ¤

                // 'ì§„ì‹¬ í€ì¹˜' : í˜ì„ ì–»ê³  ë•Œë¦¬ëŠ” ê²½ìš°, ì´ë²ˆ ê³µê²©ì— í˜ ë¯¸ë¦¬ ì ìš©
                let tempStrength = 0;
                if (card.effect === 'STRENGTH_ATTACK') tempStrength = card.effectVal;

                // (3) ìµœì¢… ë°ë¯¸ì§€ í™•ì • (í˜ & ë²„í”„ & ë°°ìœ¨ ì ìš©)
                let finalDmg = 0;
                
                // ê³µê²© ì¹´ë“œ íŒë³„ (ATTACK íƒ€ì…ì´ê±°ë‚˜, ë°ë¯¸ì§€ë¥¼ ì£¼ëŠ” SKILL ì¹´ë“œ í¬í•¨)
                const isDamageCard = card.type === 'ATTACK' || 
                                     ['AOE_STUN_ATTACK', 'AOE_DMG_POISON', 'MANA_BURN_ATTACK', 'BODY_SLAM'].includes(card.effect);

                if (isDamageCard) {
                    // í˜ ì ìš© (ìŠ¤í¬ë˜ì¹˜ ì•„íŠ¸ ë“± íŠ¹ìˆ˜ ê³µê²©ì—ë„ í˜ì´ ì‹¤ë¦¬ë„ë¡ ë³€ê²½)
                    let strengthBonus = playerStrength + tempStrength;
                    
                    // ë°ë¯¸ì§€ ê³µì‹: (ê¸°ë³¸ë€ + í˜) * ë°°ìœ¨
                    finalDmg = Math.floor((baseDmg + strengthBonus) * damageMultiplier * nextAttackMult);
                    
                    // ì²´ë ¥ 50% ì´í•˜ 2ë°° (ê°• ìŠ¤íŒŒì´í¬)
                    if (card.effect === 'LOW_HP_BONUS' && hp <= maxHp * 0.5) finalDmg *= 2;
                }
                
                // ë‹¤ìŒ ê³µê²© 2ë°° ë²„í”„ ì†Œëª¨
                if (isDamageCard || card.type === 'ATTACK') setNextAttackMult(1); 

                // ìˆ˜í•™ ì½¤ë³´ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                if (card.subject === 'MATH') {
                    if (card.effect === 'MATH_COST_REDUCE') setHand(prev => prev.map(c => c.subject === 'MATH' ? {...c, cost: Math.max(0, c.cost - 1)} : c));
                    setMathComboCount(prev => prev + 1);
                } else setMathComboCount(0);

                // ================================================================
                // 3. ê°ì¢… ì´í™íŠ¸ ì‹¤í–‰
                // ================================================================

                if (card.selfDamage) { setHp(prev => Math.max(0, prev - card.selfDamage)); triggerShake('player'); }
                
                if (card.effect === 'MANA_BURN_ATTACK') { setMental(0); setCombatLog(prev => [`ğŸ”¥ ì •ì‹ ë ¥ í­ë°œ! ${finalDmg} í”¼í•´!`, ...prev]); } 
                
                if (card.effect === 'BUFF_BLOCK') { setPersistentBlockBonus(prev => prev + card.effectVal); setCombatLog(prev => [`ğŸ›¡ï¸ ë§¤ í„´ ë°©ì–´ë„ +${card.effectVal} ì¦ê°€!`, ...prev]); }
                if (card.effect === 'STRENGTH' || card.effect === 'STRENGTH_ATTACK') setPlayerStrength(prev => prev + (card.effectVal || 2));
                if (card.effect === 'HEAL') { setHp(prev => Math.min(maxHp, prev + card.effectVal)); playRetroSound('heal'); }
                if (card.effect === 'RECOVER_MANA') { setMental(prev => Math.min(maxMental, prev + card.effectVal)); playRetroSound('heal'); }
                if (card.effect === 'RECOVER_MANA_FULL') setMental(maxMental);
                if (card.effect === 'FULL_HEAL') { setHp(maxHp); playRetroSound('heal'); }
                if (card.effect === 'DRAW') drawCards(card.effectVal, drawPile, discardPile, hand.length);
                if (card.effect === 'NEXT_ATTACK_DOUBLE') setNextAttackMult(2);
                if (card.effect === 'DOUBLE_DMG') { setDamageMultiplier(2); setCombatLog(prev => ["ğŸ’ª ì´ë²ˆ í„´ ê³µê²©ë ¥ 2ë°°!", ...prev]); }
                if (card.effect === 'IMMUNE_ONCE') setIsImmune(true);
                if (card.effect === 'DODGE') setDodgeStacks(prev => prev + 1);
                if (card.effect === 'ATTACK_BLOCK') setPlayerBlock(prev => prev + 10);
                if (card.type === 'DEFENSE') setPlayerBlock(prev => prev + card.val);
                if (card.effect === 'BLOCK_MULTIPLY') setPlayerBlock(prev => prev * (card.effectVal || 3));
                
                if (card.effect === 'GAMBLE_MANA') {
                    if (Math.random() < 0.5) { setMental(prev => Math.min(maxMental, prev + 2)); setCombatLog(prev => ["ğŸ² ë„ë°• ì„±ê³µ! ì •ì‹ ë ¥ +2", ...prev]); } 
                    else { setHp(prev => Math.max(0, prev - 5)); triggerShake('player'); setCombatLog(prev => ["ğŸ² ë„ë°• ì‹¤íŒ¨... ì²´ë ¥ -5", ...prev]); }
                }

                // [ì¶”ê°€] ìƒì¥ ìˆ˜ì—¬ (ë°ë¯¸ì§€ 3ë°° ë²„í”„)
                if (card.effect === 'NEXT_ATTACK_TRIPLE') {
                    setNextAttackMult(3);
                    setCombatLog(prev => ["ğŸ“œ ìœ„ì—„ìˆëŠ” ìƒì¥ ìˆ˜ì—¬! ë‹¤ìŒ ê³µê²© 3ë°°!", ...prev]);
                }
                
                // [ì¶”ê°€] í›ˆí™” ë§ì”€ (ë°ë¯¸ì§€ ì—†ì´ ì „ì²´ ê¸°ì ˆ)
                if (card.effect === 'AOE_STUN_ONLY') {
                     enemies.forEach(e => {
                        setEnemies(prev => prev.map(en => en.id === e.id ? { ...en, status: { ...en.status, stun: true }, intent: 'STUNNED' } : en));
                     });
                     setCombatLog(prev => ["ğŸ—£ï¸ í›ˆí™” ë§ì”€ì´ ë„ˆë¬´ ê¸¸ì–´ ì ë“¤ì´ ê¸°ì ˆí–ˆìŠµë‹ˆë‹¤...", ...prev]);
                }

                if (card.effect === 'HEAL_DRAW') { setHp(prev => Math.min(maxHp, prev + card.effectVal)); drawCards(card.drawVal, drawPile, discardPile, hand.length); playRetroSound('heal'); }
                if (card.effect === 'VULNERABLE_DRAW') { drawCards(1, drawPile, discardPile, hand.length); } 
                if (card.effect === 'MANA_DRAW') { setMental(prev => Math.min(maxMental, prev + card.effectVal)); drawCards(1, drawPile, discardPile, hand.length); }
                if (card.effect === 'MANA_BURN_STRENGTH') { const gain = mental * 2; setPlayerStrength(prev => prev + gain); setMental(0); setCombatLog(prev => [`ğŸ’ª ì •ì‹ ë ¥ ì—°ì†Œ! í˜ +${gain}`, ...prev]); }
                if (card.effect === 'BLOCK_DRAW') { drawCards(card.drawVal, drawPile, discardPile, hand.length); } 
                if (card.effect === 'DODGE_DRAW') { setDodgeStacks(prev => prev + 1); drawCards(card.drawVal, drawPile, discardPile, hand.length); }

                if (card.effect === 'COPY_ATTACK_FROM_DECK' || card.effect === 'DUPLICATE_ATTACK') {
                    const pool = [...drawPile, ...discardPile].filter(c => c.type === 'ATTACK');
                    if (pool.length > 0) {
                        const newCard = {...pool[Math.floor(Math.random() * pool.length)], uid: Math.random().toString(36).substr(2, 9)};
                        setHand(prev => [...prev, newCard]);
                        setCombatLog(prev => [`ğŸ“ ${newCard.name} ë³µì‚¬ë¨!`, ...prev]);
                    }
                }
                if (card.effect === 'UPGRADE_HAND') setHand(prev => prev.map(c => upgradeCard(c, card.effectVal || 1)));
                if (card.effect === 'COST_DOWN_HAND') setHand(prev => prev.map(c => ({...c, cost: Math.max(0, c.cost - 1)})));
                if (card.effect === 'UPGRADE_DECK_TOP' || card.effect === 'ATTACK_UPGRADE_DECK') {
                    setDrawPile(prev => { if (prev.length === 0) return prev; const newPile = [...prev]; const idx = newPile.length - 1; newPile[idx] = upgradeCard(newPile[idx]); return newPile; });
                }
                
                // 4. ê³µê²© ì‹¤í–‰ (ê³„ì‚°ëœ finalDmg ì‚¬ìš©)
                const applyHit = (eId, dmg, effects={}) => {
                    setEnemies(prev => prev.map(e => {
                        if (e.id !== eId) return e;
                        
                        let take = dmg;
                        if (e.status.vulnerable > 0 && take > 0) take = Math.floor(take * 1.5);
                        
                        if (e.block > 0) { 
                            if (e.block >= take) { e.block -= take; take = 0; } 
                            else { take -= e.block; e.block = 0; } 
                        }
                        
                        let newStatus = {...e.status};
                        if (effects.stun) { newStatus.stun = true; setCombatLog(prev => [`ğŸ’« ${e.name} ê¸°ì ˆ!`, ...prev]); }
                        if (effects.poison) newStatus.poison = (newStatus.poison || 0) + effects.poison;
                        if (effects.weak) newStatus.weak = (newStatus.weak || 0) + effects.weak;
                        if (effects.vulnerable) newStatus.vulnerable = (newStatus.vulnerable || 0) + effects.vulnerable;
                        if (card.effect === 'DISPEL') { newStatus.strength = 0; newStatus.poison = 0; setCombatLog(prev => [`âœ¨ ${e.name} ë²„í”„ í•´ì œ!`, ...prev]); }
                        if (card.effect === 'DOUBLE_POISON') newStatus.poison = (newStatus.poison || 0) * 2;

                        if (take > 0) { 
                            playRetroSound('hit'); 
                            triggerShake(e.id); 
                            showDamage(e.id, take); 
                            setCombatLog(prev => [`âš”ï¸ ${e.name}ì—ê²Œ ${take} í”¼í•´!`, ...prev]); 
                        }
                        
                        return { ...e, hp: Math.max(0, e.hp - take), status: newStatus, intent: newStatus.stun ? 'STUNNED' : e.intent };
                    }));
                };

                const isVulnerableEffect = card.effect === 'VULNERABLE' || card.effect === 'VULNERABLE_ATTACK' || card.effect === 'VULNERABLE_DRAW';
                const vulVal = card.effectVal || 1;
                let shouldStun = card.effect?.includes('STUN') && !card.effect.includes('CHANCE'); 
                if (card.effect === 'CHANCE_STUN') { if (Math.random() * 100 < card.effectVal) { shouldStun = true; } }

                if (needsTarget) applyHit(targetId, finalDmg, { stun: shouldStun, poison: card.effect?.includes('POISON')?card.effectVal:0, weak: card.effect?.includes('WEAK')?card.effectVal:0, vulnerable: isVulnerableEffect ? vulVal : 0 });
                else if (card.effect?.includes('AOE') || card.effect === 'AOE_DMG_POISON') enemies.forEach(e => applyHit(e.id, finalDmg, { stun: shouldStun, poison: card.effect==='AOE_DMG_POISON'?3:0 }));
                else if (card.effect === 'HEAL_POISON_ALL') { setHp(prev=>Math.min(maxHp, prev+10)); enemies.forEach(e => applyHit(e.id, 0, { poison: card.effectVal })); }
                
                if (card.id === 'k5') drawCards(2, drawPile, discardPile, hand.length);
                setLastCardSubject(card.subject);
            };

            const endTurn = () => {
                setDiscardPile(prev => [...prev, ...hand]); setHand([]);
                
                // [ì•ˆì „ì¥ì¹˜] í„´ ì¢…ë£Œ ì‹œ ì´ë²ˆ í„´ ê¸°ì ˆ í•´ì œ (ë‹¤ìŒ í„´ì—” í–‰ë™ ê°€ëŠ¥)
                setIsPlayerStunned(false);

                let incomingDmg = 0;
                let manaDebuff = 0;
                let willStunPlayer = false; // ì´ë²ˆ í„´ì— í”Œë ˆì´ì–´ê°€ ê¸°ì ˆí•˜ëŠ”ì§€?
                
                enemies.forEach(e => {
                    if (e.hp > 0 && !e.status.stun) {
                        // [ìˆ˜ì •] MULTI_ATTACK(ì—°ì† ê³µê²©), STUN_ATTACK(ê¸°ì ˆ) íŒ¨í„´ ì²˜ë¦¬
                        if (['ATTACK', 'BIG_ATTACK', 'MULTI_ATTACK', 'POISON_ATTACK', 'ATTACK_BUFF', 'STUN_ATTACK'].includes(e.intent)) {
                            let dmg = e.dmg + (e.status.strength||0);
                            if (e.status.weak > 0) dmg = Math.floor(dmg * 0.5);
                            
                            // ë³´ìŠ¤ë³„ íŒ¨í„´ ë°ë¯¸ì§€ ë°°ìœ¨
                            if (e.intent === 'BIG_ATTACK') dmg = Math.floor(dmg * 2.5);
                            if (e.intent === 'MULTI_ATTACK') dmg *= 2; // ì—°ì† ê³µê²©ì€ 2ë°° ë°ë¯¸ì§€ (í‘œí˜„ìƒ 2ì—°íƒ€)
                            
                            incomingDmg += Math.max(0, dmg);

                            // ê¸°ì ˆ ê³µê²©ì¸ì§€ í™•ì¸
                            if (e.intent === 'STUN_ATTACK') willStunPlayer = true;
                        }
                        if (e.intent === 'DEBUFF' && !artifacts.some(r=>r.effect==='DEBUFF_IMMUNE')) manaDebuff++;
                        if (e.intent === 'MANA_BURN' && !artifacts.some(r=>r.effect==='DEBUFF_IMMUNE')) manaDebuff += 2;
                    }
                });

                let currentBlock = playerBlock + turnBlockBuff;
                let damageTaken = 0;

                if (!isImmune && incomingDmg > 0) {
                    if (dodgeStacks > 0) {
                        setDodgeStacks(prev => prev - 1);
                        setCombatLog(prev => ["ğŸ’¨ íšŒí”¼ ì„±ê³µ!", ...prev]);
                        willStunPlayer = false; // íšŒí”¼í•˜ë©´ ê¸°ì ˆë„ í”¼í•¨
                    } else {
                        if (currentBlock >= incomingDmg) { 
                            currentBlock -= incomingDmg; 
                            willStunPlayer = false; // [ì„ íƒ] ë°©ì–´ë¡œ ì™„ì „íˆ ë§‰ìœ¼ë©´ ê¸°ì ˆ ë©´ì—­
                        } else { 
                            damageTaken = incomingDmg - currentBlock; 
                            currentBlock = 0; 
                        }
                    }
                }

                if (damageTaken > 0) { 
                    playRetroSound('hit'); 
                    setHp(prev => Math.max(0, prev - damageTaken)); 
                    triggerShake('player');
                    showDamage('player', damageTaken); 
                    
                    if (damageTaken >= 40) {
                        setRedFlash(true);
                        setTimeout(() => setRedFlash(false), 500);
                    }
                    
                    // ë°ë¯¸ì§€ë¥¼ ì…ì—ˆê³ , ê¸°ì ˆ ê³µê²©ì´ì—ˆë‹¤ë©´ -> ê¸°ì ˆ ìƒíƒœ ë¶€ì—¬
                    if (willStunPlayer) {
                        setIsPlayerStunned(true);
                        setCombatLog(prev => ["ğŸ’« ìœ½! ê°•ë ¥í•œ ì¶©ê²©ì— ê¸°ì ˆí–ˆìŠµë‹ˆë‹¤!", ...prev]);
                    } else {
                        setCombatLog(prev => [`ğŸ’” ${damageTaken} í”¼í•´ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤!`, ...prev]); 
                    }
                }

                if (!artifacts.some(r => r.effect === 'BLOCK_RETAIN')) setPlayerBlock(0);
                else setPlayerBlock(currentBlock);

                // ì  ìƒíƒœ ì—…ë°ì´íŠ¸ (ë°©ì–´ë„ ì´ˆê¸°í™” í¬í•¨)
                setEnemies(prev => prev.map(e => {
                    let nextHp = e.hp;
                    if (e.status.poison) { nextHp -= e.status.poison; setCombatLog(prev => [`ğŸ¤¢ ${e.name} ë… í”¼í•´ ${e.status.poison}`, ...prev]); }
                    
                    let nextBlock = 0; // í„´ ì¢…ë£Œ ì‹œ ì  ë°©ì–´ë„ ì´ˆê¸°í™”
                    
                    if (e.intent === 'DEFEND') nextBlock += 15;
                    if (e.intent === 'SUPER_DEFEND') { nextBlock += 40; setCombatLog(prev => [`ğŸ›¡ï¸ ${e.name}ì˜ ì² ë²½ ë°©ì–´! (+40)`, ...prev]); }
                    if (e.intent === 'IRON_WALL') { nextBlock += 999; setCombatLog(prev => [`ğŸ° ${e.name}ì´(ê°€) ì ˆëŒ€ ë°©ì–´ íƒœì„¸ë¥¼ ì·¨í•©ë‹ˆë‹¤.`, ...prev]); }
                    if (e.intent === 'HEAL') { const healAmt = Math.floor(e.maxHp * 0.15); nextHp = Math.min(e.maxHp, nextHp + healAmt); setCombatLog(prev => [`ğŸ’– ${e.name}ì´(ê°€) ì²´ë ¥ì„ ${healAmt} íšŒë³µí–ˆìŠµë‹ˆë‹¤.`, ...prev]); }
                    if (e.intent === 'MANA_BURN') { setCombatLog(prev => [`ğŸ§  ${e.name}ì˜ í›ˆí™” ë§ì”€.. ë¨¸ë¦¬ê°€ ì•„í”•ë‹ˆë‹¤. (ë‹¤ìŒ í„´ ì •ì‹ ë ¥ -2)`, ...prev]); }
                    
                    let nextStatus = { ...e.status, stun: false, weak: Math.max(0, (e.status.weak||0)-1), vulnerable: Math.max(0, (e.status.vulnerable||0)-1) };
                    if (e.intent === 'BUFF') nextStatus.strength = (nextStatus.strength||0) + 1;

                    // 98ì¸µ ë³´ìŠ¤ ê°•í™”
                    if (stage === 98) {
                        nextStatus.strength = (nextStatus.strength || 0) + 2;
                        setCombatLog(prev => [`ğŸ”¥ ${e.name}ì˜ ì••ë°•ê°ì´ ì‹¬í•´ì§‘ë‹ˆë‹¤! (í˜ +2)`, ...prev]);
                    }

                    let nextIntent = e.intent; 
                    if (nextHp > 0) {
                         if (stageType === 'BOSS') nextIntent = getBossIntent(e, turn + 1, stage);
                         else {
                            const rand = Math.random();
                            if (rand < 0.7) nextIntent = 'ATTACK';
                            else if (rand < 0.9) nextIntent = 'DEFEND';
                            else nextIntent = 'BUFF';
                         }
                    }
                    return { ...e, hp: nextHp, block: nextBlock, status: nextStatus, intent: nextIntent };
                }));

                setMental(Math.max(0, maxMental - manaDebuff));
                setTurn(prev => prev + 1);
                setIsImmune(false);
                setNextAttackMult(1);
                setDamageMultiplier(1); 
                
                if (persistentBlockBonus > 0) { setPlayerBlock(prev => prev + persistentBlockBonus); setCombatLog(prev => [`ğŸ›¡ï¸ í„´ ì‹œì‘ ë°©ì–´ë„ +${persistentBlockBonus}`, ...prev]); }
                let drawCount = 3 + (artifacts.find(r => r.effect === 'DRAW_PLUS') ? 1 : 0);
                setTimeout(() => drawCards(drawCount, drawPile, [...discardPile, ...hand], 0), 200);
            };

            useEffect(() => {
                if (gameState === 'COMBAT') {
                    const alive = enemies.filter(e => e.hp > 0);
                    if (alive.length === 0 && enemies.length > 0) { endCombat(true); } else if (hp <= 0) { endCombat(false); }
                }
            }, [enemies, hp, gameState]);

            const endCombat = (isVictory) => {
                if (!isVictory) { setGameState('GAME_OVER'); return; }
                if (stage >= 100) { setGameState('VICTORY'); return; }
                const healRelic = artifacts.find(r => r.effect === 'POST_COMBAT_HEAL');
                if (healRelic) setHp(prev => Math.min(maxHp, prev + healRelic.val));
                let goldReward = Math.floor(400 + Math.random() * 300) + (stageType === 'BOSS' ? 300 : 0);
                setGold(prev => prev + goldReward);
                setCombatLog([]);
                if (stageType === 'BOSS' && [20, 40, 60, 80].includes(stage)) {
                    setRelicRewards(shuffle(RELICS.filter(r => !artifacts.some(a => a.id === r.id))).slice(0, 2));
                    setGameState('RELIC_REWARD');
                } else {
                    const rewards = [];
                    while(rewards.length < 3) rewards.push(getRandomCard(activeSubjects, deck, { COMMON: 60, SPECIAL: 25, RARE: 10, LEGEND: 5 }, true));
                    setRewardCards(rewards);
                    setRewardTeacher(SUBJECTS[activeSubjects[Math.floor(Math.random() * activeSubjects.length)]]);
                    setGameState('REWARD');
                }
            };

            const startEvent = () => {
                setGameState('EVENT');
                const available = EVENTS.filter(e => !encounteredEventIds.includes(e.id));
                const evt = available.length > 0 ? available[Math.floor(Math.random()*available.length)] : EVENTS[Math.floor(Math.random()*EVENTS.length)];
                setCurrentEvent(evt);
                if(available.length > 0) setEncounteredEventIds(prev => [...prev, evt.id]);
                setEventResult(null);
            };

            const startShop = (subjects) => {
                setGameState('SHOP');
                setTempSelected([]);
                const cards = [
                    getRandomCard(subjects, deck, { COMMON: 60, SPECIAL: 30, RARE: 10, LEGEND: 0 }),
                    getRandomCard(subjects, deck, { COMMON: 40, SPECIAL: 40, RARE: 20, LEGEND: 0 }),
                    getRandomCard(subjects, deck, { COMMON: 20, SPECIAL: 40, RARE: 30, LEGEND: 10 })
                ].map(c => ({...c, price: RARITY[c.rarity].price}));
                setShopCards(cards);
            };

            const startTeacherEvent = () => {
                setGameState('TEACHER_EVENT');
                const s = activeSubjects[Math.floor(Math.random() * activeSubjects.length)];
                setTeacherEvent({ ...SUBJECTS[s] });
                setTempSelected([]);
            };

            const handleTeacherChoice = (choice) => {
                setTempSelected([]);
                playRetroSound('click');
                if (choice === 'REMOVE') setGameState('TEACHER_REMOVE');
                else if (choice === 'COPY') setGameState('TEACHER_COPY');
                else if (choice === 'UPGRADE') setGameState('TEACHER_UPGRADE');
            };

            const toggleCardSelection = (index, maxSelect) => {
                playRetroSound('click');
                if (tempSelected.includes(index)) setTempSelected(prev => prev.filter(i => i !== index));
                else if (tempSelected.length < maxSelect) setTempSelected(prev => [...prev, index]);
            };

            const confirmSelectionAction = () => {
                playRetroSound('click');
                let newDeck = [...deck];
                if (gameState === 'TEACHER_REMOVE' || gameState === 'SHOP_REMOVE') {
                    const sortedIndices = [...tempSelected].sort((a, b) => b - a);
                    sortedIndices.forEach(idx => newDeck.splice(idx, 1));
                    setDeck(newDeck);
                    if (gameState === 'SHOP_REMOVE') { setGold(prev => prev - 2000); setGameState('SHOP'); }
                    else { setGameState('MAP'); generateStage(stage + 1); }
                }
                else if (gameState === 'TEACHER_COPY') {
                    tempSelected.forEach(idx => newDeck.push({ ...newDeck[idx], uid: Math.random().toString(36).substr(2, 9) }));
                    setDeck(newDeck); setGameState('MAP'); generateStage(stage + 1);
                }
                else if (gameState === 'TEACHER_UPGRADE' || gameState === 'LUNCH_UPGRADE') {
                    tempSelected.forEach(idx => { newDeck[idx] = upgradeCard(newDeck[idx], 2); });
                    setDeck(newDeck); setGameState('MAP'); generateStage(stage + 1);
                }
                setTempSelected([]);
            };

            const gameStats = {
                strength: playerStrength,
                hasPenRelic: artifacts.some(r => r.effect === 'PEN_BUFF'),
                damageMultiplier,
                nextAttackMult,
                isLowHp: hp <= maxHp * 0.5
            };

            return (
                <div id="game-container" className="font-sans select-none text-white relative">
                    <div className="absolute top-4 right-4 z-50 flex gap-2">
                        <button onClick={toggleMute} className="bg-slate-700 p-2 rounded-full hover:bg-slate-600 transition shadow">
                            {isMuted ? <Icon name="VolumeX" size={24}/> : <Icon name="Volume2" size={24}/>}
                        </button>
                    </div>

                    {gameState === 'MENU' && (
                        <div className="w-full h-full flex flex-col items-center justify-center bg-slate-800 animate-fade-in absolute inset-0 z-50">
                            <div className="text-9xl mb-8 animate-bounce">ğŸ«</div>
                            <h1 className="text-6xl font-black mb-4 text-yellow-400 drop-shadow-lg">ëŒ€ì†¡ ë“±ë°˜</h1>
                            <p className="text-2xl mb-8 text-slate-300">100êµì‹œì˜ ì „ì„¤ v1.3</p>
                            <div className="flex gap-4">
                                <button onClick={startGame} className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-12 rounded-xl text-xl shadow-xl transition transform hover:scale-105">ë“±êµí•˜ê¸° (ì‹œì‘)</button>
                                <button onClick={() => setGameState('RANKING')} className="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-4 px-12 rounded-xl text-xl shadow-xl transition transform hover:scale-105 flex items-center gap-2"><Icon name="Trophy" /> ëª…ì˜ˆì˜ ì „ë‹¹</button>
                            </div>
                        </div>
                    )}

                    {gameState === 'RANKING' && (
                        <div className="w-full h-full bg-slate-900 flex flex-col items-center justify-center p-8 animate-fade-in absolute inset-0 z-50">
                            <h2 className="text-4xl font-bold mb-8 text-yellow-400 flex items-center gap-3"><Icon name="Trophy" size={40}/> ëª…ì˜ˆì˜ ì „ë‹¹ (Top 10)</h2>
                            <div className="bg-slate-800 p-8 rounded-xl w-full max-w-4xl shadow-2xl border border-slate-600">
                                {highScores.length > 0 ? (
                                   <table className="w-full text-left rank-table">
                                        <thead>
                                            <tr>
                                                <th>ìˆœìœ„</th>
                                                <th>ì´ë¦„</th>
                                                <th>ìµœì¢… í•™ë ¥</th> {/* ë„ë‹¬ êµì‹œ -> ìµœì¢… í•™ë ¥ìœ¼ë¡œ ë³€ê²½ */}
                                                <th>ì¡¸ì—… ì ìˆ˜</th> {/* ì»¬ëŸ¼ ì¶”ê°€ */}
                                                <th>ë‚ ì§œ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {highScores.map((s, i) => (
                                                <tr key={i} className={i===0?'text-yellow-300 font-bold':''}>
                                                    <td>{i+1}ìœ„</td>
                                                    <td>{s.name}</td>
                                                    <td>{s.stage}êµì‹œ</td>
                                                    <td className="text-green-400 font-mono">
                                                        {/* ì ìˆ˜ê°€ ìˆìœ¼ë©´ ì½¤ë§ˆ(,) ì°ì–´ì„œ í‘œì‹œ, ì—†ìœ¼ë©´ 0ì  */}
                                                        {(s.score || 0).toLocaleString()}ì 
                                                    </td>
                                                    <td>{s.date}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                ) : <div className="text-center text-slate-400 py-12">ì•„ì§ ë“±ë¡ëœ ì „ì„¤ì´ ì—†ìŠµë‹ˆë‹¤. ë„ì „í•˜ì„¸ìš”!</div>}
                            </div>
                            <button onClick={() => setGameState('MENU')} className="mt-8 bg-slate-600 hover:bg-slate-500 px-8 py-3 rounded-xl text-lg font-bold">ë’¤ë¡œ ê°€ê¸°</button>
                        </div>
                    )}

                    {gameState === 'SELECT_SUBJECTS' && (
                        /* [ìˆ˜ì •] overflow-y-auto ì¶”ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ ë³€ê²½, flex-wrapìœ¼ë¡œ ì¤„ë°”ê¿ˆ í—ˆìš© */
                        <div className="w-full h-full bg-slate-800 flex flex-col items-center p-4 animate-fade-in absolute inset-0 z-50 overflow-y-auto">
                            <div className="w-full max-w-6xl flex flex-col items-center min-h-full py-12"> {/* ë‚´ë¶€ ì—¬ë°±(py-12) í™•ë³´ */}
                                <h2 className="text-4xl font-bold mb-2 text-white text-center">ì´ë²ˆ í•™ê¸° ìˆ˜ê°• ì‹ ì²­</h2>
                                <p className="text-slate-400 mb-8 text-center">5ê°œì˜ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš” ({selectedSubjects.length}/5)</p>
                                
                                {/* [ìˆ˜ì •] Grid ëŒ€ì‹  Flex Wrap ì‚¬ìš©ìœ¼ë¡œ í™”ë©´ í­ì— ë§ì¶° ìì—°ìŠ¤ëŸ½ê²Œ ë°°ì¹˜ */}
                                {/* [ìˆ˜ì •] íˆë“  ê³¼ëª©(ê´€ë¦¬ì) ì²˜ë¦¬ë¥¼ í¬í•¨í•œ ìˆ˜ê°•ì‹ ì²­ ëª©ë¡ */}
                                <div className="flex flex-wrap gap-4 mb-12 justify-center w-full">
                                    {Object.values(SUBJECTS).filter(s => s.id !== 'BASIC').map((subj) => {
                                        // ê´€ë¦¬ì ê³¼ëª©ì¸ë° ì•„ì§ í´ë¦¬ì–´ ëª»í–ˆìœ¼ë©´ 'ì ê¹€' ì²˜ë¦¬
                                        if (subj.id === 'ADMIN' && !isGameCleared) {
                                            return (
                                                <div key="LOCKED" className="w-32 sm:w-40 p-4 rounded-xl border-2 border-slate-700 bg-slate-800 opacity-50 flex flex-col items-center gap-2 grayscale cursor-not-allowed">
                                                    <div className="text-4xl">ğŸ”’</div>
                                                    <div className="font-bold text-lg">???</div>
                                                    <div className="text-xs text-center">100êµì‹œ í´ë¦¬ì–´ ì‹œ<br/>í•´ê¸ˆë©ë‹ˆë‹¤.</div>
                                                </div>
                                            );
                                        }

                                        // ê·¸ ì™¸(ì¼ë°˜ ê³¼ëª© or í•´ê¸ˆëœ ê´€ë¦¬ì)
                                        return (
                                            <div key={subj.id} onClick={() => {
                                                playRetroSound('click');
                                                if (selectedSubjects.includes(subj.id)) setSelectedSubjects(prev => prev.filter(id => id !== subj.id));
                                                else if (selectedSubjects.length < 5) setSelectedSubjects(prev => [...prev, subj.id]);
                                            }} className={`w-32 sm:w-40 p-4 rounded-xl border-2 cursor-pointer transition-all flex flex-col items-center gap-2 
                                                ${selectedSubjects.includes(subj.id) 
                                                    ? (subj.id === 'ADMIN' ? 'bg-yellow-600 border-yellow-300 ring-4 ring-yellow-500 transform scale-105 shadow-2xl' : 'bg-blue-600 border-blue-300 transform scale-105 shadow-lg') 
                                                    : (subj.id === 'ADMIN' ? 'bg-slate-700 border-yellow-500/50 hover:bg-slate-600 hover:border-yellow-400' : 'bg-slate-700 border-slate-600 hover:bg-slate-600')
                                                } opacity-80 hover:opacity-100`}>
                                                <div className="text-4xl">{subj.emoji}</div>
                                                <div className={`font-bold text-lg whitespace-nowrap ${subj.id==='ADMIN'?'text-yellow-400':''}`}>{subj.name}</div>
                                                <div className="text-xs text-center break-keep opacity-80 leading-tight">{subj.desc}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <button onClick={confirmSubjects} disabled={selectedSubjects.length !== 5} className={`font-bold py-4 px-16 rounded-xl text-2xl transition shadow-xl mb-12 ${selectedSubjects.length === 5 ? 'bg-green-600 hover:bg-green-500 text-white cursor-pointer transform hover:scale-105' : 'bg-slate-600 text-slate-400 cursor-not-allowed'}`}>ìˆ˜ì—… ì‹œì‘</button>
                            </div>
                        </div>
                    )}

                    {!['MENU', 'SELECT_SUBJECTS', 'RANKING'].includes(gameState) && (
                        <div className="w-full h-full flex flex-col relative">
                            <div className="bg-slate-800 p-3 flex justify-between items-center shadow-lg z-10 border-b border-slate-700">
                                <div className="flex gap-6 items-center">
                                    <div className="font-black text-xl flex items-center gap-2"><div className="w-8 h-8 rounded bg-yellow-500 text-black flex items-center justify-center">{stage}</div> êµì‹œ</div>
                                    <div className="flex gap-4 text-sm font-bold text-slate-300">
                                        <span className="flex items-center gap-1 text-red-400"><Icon name="Heart" size={16}/> {hp}/{maxHp}</span>
                                        <span className="flex items-center gap-1 text-blue-400"><Icon name="Brain" size={16}/> {mental}/{maxMental}</span>
                                        <span className="flex items-center gap-1 text-yellow-400"><Icon name="Coins" size={16}/> {gold}</span>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    {activeSubjects.map(s => <span key={s} title={SUBJECTS[s].name} className="text-xl cursor-help">{SUBJECTS[s].emoji}</span>)}
                                </div>
                            </div>

                            <div className="flex-1 relative bg-[url('https://www.transparenttextures.com/patterns/blackboard.png')] bg-green-900/90 bg-blend-multiply overflow-hidden flex flex-col">
                                {gameState === 'COMBAT' && (
                                    <div className="flex-1 flex flex-col relative">
                                        <div className="flex-1 flex px-8 pb-32 items-center">
                                           {/* [ìˆ˜ì •ë¨] í”Œë ˆì´ì–´ ì´ˆìƒí™” ì˜ì—­ ì‹œì‘ */}
                                            <div className="w-1/3 flex flex-col items-center justify-center border-r border-white/10 h-full relative">
                                                {/* 1. flash-red í´ë˜ìŠ¤ ì¡°ê±´ë¶€ ì¶”ê°€ë¨ */}
                                                <div className={`flex flex-col items-center ${shakeTarget === 'player' ? 'hit-effect' : ''} ${redFlash ? 'flash-red rounded-xl p-2' : ''}`}>
                                                    <div className="text-8xl mb-4 relative drop-shadow-2xl">
                                                        ğŸ§‘â€ğŸ“
                                                        {playerBlock > 0 && <div className="absolute -top-2 -right-6 bg-blue-600 text-white px-3 py-1 rounded-full text-lg font-bold border-2 border-blue-300 flex items-center shadow-lg animate-bounce"><Icon name="Shield" size={18} className="mr-1"/> {playerBlock}</div>}
                                                        {dodgeStacks > 0 && <div className="absolute top-0 -left-8 bg-green-600 text-white px-2 py-1 rounded-full text-sm font-bold border border-green-400 flex items-center shadow-lg"><Icon name="Wind" size={16} className="mr-1"/> {dodgeStacks}</div>}
                                                        
                                                        {isPlayerStunned && <div className="absolute top-0 right-0 text-4xl animate-spin">ğŸ’«</div>}
                                                        {/* 2. [ì¶”ê°€ë¨] í”Œë ˆì´ì–´ ë°ë¯¸ì§€ ìˆ«ì í‘œì‹œ */}
                                                        {dmgOverlays.filter(o => o.targetId === 'player').map(o => (
                                                            <div key={o.id} className={`dmg-num ${o.type === 'SUPER' ? 'dmg-super' : o.type === 'CRIT' ? 'dmg-crit' : 'dmg-normal'}`}>-{o.val}</div>
                                                        ))}
                                                    </div>
                                                    <div className="w-48 bg-slate-900 h-4 rounded-full overflow-hidden border border-slate-500 relative mb-2">
                                                        <div className="bg-green-500 h-full transition-all duration-300" style={{width: `${(hp/maxHp)*100}%`}}></div>
                                                        <div className="absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white drop-shadow">{hp} / {maxHp}</div>
                                                    </div>
                                                    <div className="flex gap-2 text-sm font-bold opacity-90 bg-black/30 px-3 py-1 rounded-full">
                                                        {playerStrength > 0 && <span className="text-red-300">í˜ {playerStrength}</span>}
                                                        {permStrength > 0 && <span className="text-amber-300">(ì˜êµ¬+{permStrength})</span>}
                                                        <span className="text-blue-300 flex items-center gap-1 ml-2"><Icon name="Brain" size={14}/> {mental}/{maxMental}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            {/* [ìˆ˜ì •ë¨] í”Œë ˆì´ì–´ ì´ˆìƒí™” ì˜ì—­ ë */}
                                            <div className="w-2/3 flex justify-center items-center gap-8 pl-8 flex-wrap content-center h-full">
                                                {enemies.filter(e => e.hp > 0).map(e => (
                                                    <div key={e.id} onClick={() => selectedCard && playCard(selectedCard, e.id)} className={`relative group cursor-pointer transition-all ${shakeTarget === e.id ? 'hit-effect' : ''} hover:scale-105`}>
                                                        
                                                        {/* [ì¶”ê°€] ì  ë°ë¯¸ì§€ ì˜¤ë²„ë ˆì´ (ì—¬ê¸° ì¶”ê°€ë¨!) */}
                                                        {dmgOverlays.filter(o => o.targetId === e.id).map(o => (
                                                            <div key={o.id} className={`dmg-num ${o.type === 'SUPER' ? 'dmg-super' : o.type === 'CRIT' ? 'dmg-crit' : 'dmg-normal'}`}>{o.val}</div>
                                                        ))}

                                                        <div className="absolute -top-12 left-1/2 -translate-x-1/2 bg-white text-black px-3 py-1 rounded-full font-bold shadow-lg flex items-center gap-1 z-10 whitespace-nowrap border-2 border-slate-300">
                                                            {e.intent.includes('ATTACK') && <><Icon name="Zap" size={16} className="text-red-600 fill-current"/> {Math.floor((e.dmg + (e.status.strength||0)) * (e.status.weak ? 0.5 : 1) * (e.intent==='BIG_ATTACK'?2.5:1) * (e.intent==='MULTI_ATTACK'?2:1))}</>}
                                                            {e.intent === 'DEFEND' && <Icon name="Shield" size={16} className="text-blue-600"/>}
                                                            {e.intent === 'SUPER_DEFEND' && <div className="flex items-center text-blue-800"><Icon name="Shield" size={16} className="fill-current"/>+</div>}
                                                            {e.intent === 'IRON_WALL' && <Icon name="Shield" size={16} className="text-yellow-600 fill-current"/>}
                                                            {e.intent === 'HEAL' && <Icon name="Heart" size={16} className="text-pink-600 fill-current"/>}
                                                            {(e.intent === 'BUFF' || e.intent === 'WAIT') && <Icon name="ArrowUp" size={16} className="text-green-600"/>}
                                                            {(e.intent === 'DEBUFF' || e.intent === 'MANA_BURN') && <Icon name="Brain" size={16} className="text-purple-600"/>}
                                                            {e.intent === 'STUNNED' && 'ğŸ’«'}
                                                        </div>
                                                        <div className="w-32 h-32 bg-slate-700/80 rounded-xl border-4 border-slate-500 flex items-center justify-center text-6xl shadow-xl">
                                                            {e.emoji}
                                                            {e.block > 0 && <div className="absolute top-0 right-0 bg-blue-500 text-white text-xs px-2 py-1 rounded-bl-lg font-bold border-l border-b border-blue-300"><Icon name="Shield" size={12} className="inline"/> {e.block}</div>}
                                                        </div>
                                                        <div className="mt-2 w-full bg-slate-800 h-3 rounded-full overflow-hidden relative border border-slate-600">
                                                            <div className="bg-red-500 h-full transition-all duration-300" style={{width: `${(e.hp/e.maxHp)*100}%`}}></div>
                                                        </div>
                                                        <div className="text-center font-bold text-sm mt-1 text-white drop-shadow-md bg-black/30 rounded px-1">{e.name} ({e.hp})</div>
                                                        <div className="flex justify-center gap-1 mt-1 text-xs">
                                                            {e.status.poison > 0 && <span className="text-green-400 bg-black/50 px-1 rounded">ë…{e.status.poison}</span>}
                                                            {e.status.stun && <span className="text-yellow-400 bg-black/50 px-1 rounded">ê¸°ì ˆ</span>}
                                                            {e.status.weak > 0 && <span className="text-gray-400 bg-black/50 px-1 rounded">ì•½í™”{e.status.weak}</span>}
                                                            {e.status.vulnerable > 0 && <span className="text-red-400 bg-black/50 px-1 rounded">ğŸ’”{e.status.vulnerable}</span>}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="absolute bottom-0 w-full h-auto bg-gradient-to-t from-black/90 via-black/60 to-transparent pt-12 pb-4 flex flex-col justify-end items-center z-20">
                                            <div className="absolute top-2 w-full text-center pointer-events-none">
                                                {combatLog[0] && <span className="bg-black/60 px-6 py-1 rounded-full text-yellow-300 font-bold animate-pulse text-lg border border-yellow-500/30">{combatLog[0]}</span>}
                                            </div>
                                            <div className="flex items-end justify-center gap-6 w-full max-w-6xl px-4">
                                                <div className="relative group">
                                                    <div className="w-20 h-28 bg-slate-700 rounded border-2 border-slate-500 flex items-center justify-center font-bold text-slate-400 text-xl shadow-lg cursor-help">{drawPile.length}</div>
                                                    <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-xs text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">ë‚¨ì€ ì¹´ë“œ</div>
                                                </div>
                                                <div className="flex justify-center -space-x-4 pb-2 min-h-[200px] px-4 flex-1 max-w-4xl">
                                                    {hand.map((card, i) => (
                                                        <div key={card.uid} className="transition-all hover:-translate-y-16 hover:scale-110 hover:z-50 origin-bottom duration-200" style={{zIndex: i}}>
                                                            <Card 
                                                                card={card} 
                                                                isSelected={selectedCard?.uid === card.uid} 
                                                                gameStats={gameStats}
                                                                onClick={(c) => {
                                                                    const needsTarget = (c.type === 'ATTACK' || ['STUN', 'POISON', 'WEAK', 'DISPEL', 'VULNERABLE'].some(e => c.effect?.includes(e))) && !['AOE_ATTACK', 'AOE_STUN_ATTACK', 'AOE_DMG_POISON'].includes(c.effect);
                                                                    if (!needsTarget) playCard(c, null);
                                                                    else setSelectedCard(selectedCard?.uid === c.uid ? null : c);
                                                                }}
                                                            />
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex flex-col gap-3 items-center">
                                                    <button onClick={endTurn} className="bg-amber-600 hover:bg-amber-500 text-white font-bold py-4 px-8 rounded-xl shadow-lg border-b-4 border-amber-800 active:border-b-0 active:translate-y-1 transition-all text-lg">í„´ ì¢…ë£Œ</button>
                                                    <div className="relative group">
                                                        <div className="w-20 h-28 bg-slate-700 rounded border-2 border-slate-500 flex items-center justify-center font-bold text-slate-400 text-xl shadow-lg cursor-help">{discardPile.length}</div>
                                                        <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-xs text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">ë²„ë¦° ì¹´ë“œ</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {gameState === 'REWARD' && (
                                    <div className="flex-1 flex flex-col items-center justify-center p-4 animate-fade-in bg-black/80 z-30">
                                        {rewardTeacher && (
                                            <div className="flex flex-col items-center mb-8 animate-bounce">
                                                <div className="text-8xl mb-2">{rewardTeacher.teacherEmoji}</div>
                                                <div className="bg-white text-black p-4 rounded-xl relative bubble font-bold">"{rewardTeacher.teacher} ì„ ìƒë‹˜ì´ ì¹­ì°¬í•©ë‹ˆë‹¤! ì°¸ ì˜í–ˆì–´ìš”."</div>
                                            </div>
                                        )}
                                        <h2 className="text-4xl font-bold mb-8 text-yellow-400">ìˆ˜ì—… ì¢…ë£Œ! ë³´ìƒ ì„ íƒ</h2>
                                        <div className="flex gap-6 mb-8">{rewardCards.map((c, i) => (<div key={i} className="hover:scale-110 transition-transform"><Card card={c} onClick={() => { setDeck([...deck, c]); setGameState('MAP'); generateStage(stage+1); }} /></div>))}</div>
                                        <button onClick={() => { setGameState('MAP'); generateStage(stage+1); }} className="text-slate-400 hover:text-white underline">ê±´ë„ˆë›°ê¸°</button>
                                    </div>
                                )}

                                {gameState === 'RELIC_REWARD' && (
                                    <div className="flex-1 flex flex-col items-center justify-center p-4 animate-fade-in bg-black/80 z-30">
                                        <h2 className="text-4xl font-bold mb-8 text-amber-400">ğŸ† ì¤‘ê°„ê³ ì‚¬ í†µê³¼! ìœ ë¬¼ ì„ íƒ</h2>
                                        <div className="flex gap-8 mb-8">
                                            {relicRewards.map((relic, i) => (
                                                <div key={i} onClick={() => { 
                                                    const newArtifacts = [...artifacts, relic]; setArtifacts(newArtifacts); 
                                                    if (relic.effect === 'MAX_HP') { setMaxHp(prev => prev + relic.val); setHp(prev => prev + relic.val); }
                                                    if (relic.effect === 'MAX_MANA') { setMaxMental(prev => prev + relic.val); setMental(prev => prev + relic.val); }
                                                    setGameState('MAP'); generateStage(stage + 1, activeSubjects, deck, newArtifacts); 
                                                }} className="bg-slate-700 p-8 rounded-xl border-2 border-amber-400 cursor-pointer hover:scale-105 transition-transform w-64 flex flex-col items-center gap-4 shadow-xl">
                                                    <div className="text-6xl">{relic.emoji}</div><div className="font-bold text-xl text-amber-300">{relic.name}</div><div className="text-sm text-slate-300 text-center break-keep">{relic.desc}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {gameState === 'EVENT' && currentEvent && (
                                    <div className="flex-1 flex items-center justify-center p-4 z-30 bg-black/70">
                                        <div className="bg-slate-800 p-8 rounded-xl max-w-2xl w-full text-center border border-slate-600 shadow-2xl animate-fade-in">
                                            <h2 className="text-3xl font-bold mb-4 text-yellow-400">{currentEvent.title}</h2>
                                            <p className="text-lg mb-8 whitespace-pre-line text-slate-300">{currentEvent.desc}</p>
                                            {!eventResult ? (
                                                <div className="grid gap-4">
                                                    {currentEvent.choices.map((c, i) => (
                                                        <button key={i} onClick={() => {
                                                            const { type, val, cost } = c.reward;
                                                            let msg = c.msg;
                                                            if (type === 'GOLD') setGold(prev => prev + val);
                                                            else if (type === 'HP_LOSS') setHp(prev => Math.max(0, prev - val));
                                                            else if (type === 'HEAL') setHp(prev => Math.min(maxHp, prev + val));
                                                            else if (type === 'MAX_MANA') setMaxMental(prev => prev + val);
                                                            else if (type === 'MAX_HP') setMaxHp(prev => prev + val);
                                                            else if (type === 'PERM_STRENGTH') setPermStrength(prev => prev + val);
                                                            else if (type === 'TRADE_HP_MAXHP') { setHp(prev => prev - cost); setMaxHp(prev => prev + val); }
                                                            else if (type === 'UPGRADE_RANDOM') setDeck(prev => { const d=[...prev]; const idx=Math.floor(Math.random()*d.length); if(d[idx]) d[idx]=upgradeCard(d[idx]); return d; });
                                                            else if (type === 'GET_RARE_CARD') setDeck(prev => [...prev, getRandomCard(activeSubjects, deck, {COMMON:0, SPECIAL:0, RARE:100, LEGEND:0})]);
                                                            else if (type === 'YJH_GACHA') {
                                                                const r = Math.random();
                                                                if (r < 0.33) { const card = getRandomCard(activeSubjects, deck, {COMMON:0, SPECIAL:100, RARE:0, LEGEND:0}); setDeck(prev => [...prev, card]); msg = `ğŸ‰ ëŒ€ë°•! [${card.name}] íšë“!`; }
                                                                else if (r < 0.66) { setMaxMental(prev => prev + 1); setMental(prev => prev + 1); msg = "âœ¨ ë¨¸ë¦¬ê°€ ë§‘ì•„ì¡Œë‹¤! ì •ì‹ ë ¥ +1"; }
                                                                else { setHp(prev => Math.min(maxHp, prev + 30)); msg = "ğŸ ë“ ë“ í•˜ë‹¤! ì²´ë ¥ 30 íšŒë³µ"; }
                                                            }
                                                            setEventResult(msg);
                                                        }} className="bg-slate-700 hover:bg-slate-600 p-4 rounded text-left font-bold transition flex justify-between border border-slate-500"><span>{i+1}. {c.txt}</span><span className="text-xs text-slate-400">ì„ íƒ</span></button>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div><div className="bg-black/30 p-4 rounded mb-6 text-green-400 font-bold">{eventResult}</div><button onClick={() => { setGameState('MAP'); generateStage(stage + 1); setEventResult(null); }} className="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold">ë‹¤ìŒìœ¼ë¡œ</button></div>
                                            )}
                                        </div>
                                    </div>
                                )}
                                
                              {gameState === 'SHOP' && (
                                    /* [ìˆ˜ì •] z-index ë†’ì„(z-30) ë° í•˜ë‹¨ ì—¬ë°±(pb-40) ëŒ€í­ ì¶”ê°€í•˜ì—¬ ì˜ë¦¼ ë°©ì§€ */
                                    <div className="flex-1 overflow-y-auto p-8 relative bg-slate-900/95 z-30">
                                        <div className="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
                                            <h2 className="text-3xl md:text-4xl font-bold text-white flex items-center gap-3"><Icon name="ShoppingCart" size={40}/> ë§¤ì </h2>
                                            <div className="text-xl md:text-2xl text-yellow-400 font-bold flex items-center gap-2"><Icon name="Coins"/> {gold}ì›</div>
                                        </div>
                                        <div className="flex flex-col items-center gap-12 pb-40"> {/* pb-40ìœ¼ë¡œ í•˜ë‹¨ ê³µê°„ ë„‰ë„‰í•˜ê²Œ í™•ë³´ */}
                                            <div className="flex flex-col md:flex-row gap-8 items-center bg-slate-800 p-6 rounded-xl border border-slate-600 w-full max-w-4xl justify-between">
                                                <div className="flex items-center gap-4"><span className="text-5xl">ğŸ¥</span><div className="text-left"><div className="font-bold text-xl text-amber-200">ë§¤ì  ë¹µ</div><div className="text-sm text-slate-400">ì²´ë ¥ì„ 30 íšŒë³µí•©ë‹ˆë‹¤.</div></div></div>
                                                <button onClick={() => { if(gold>=500){setGold(g=>g-500); setHp(h=>Math.min(maxHp, h+30));} }} disabled={gold<500} className={`px-6 py-3 rounded-lg font-bold whitespace-nowrap ${gold>=500?'bg-green-600 hover:bg-green-500':'bg-slate-600 text-slate-400'}`}>500ì› êµ¬ë§¤</button>
                                            </div>
                                            
                                            <div className="flex gap-4 md:gap-8 flex-wrap justify-center">
                                                {shopCards.map((card, i) => ( card ? (
                                                    <div key={i} className="flex flex-col items-center gap-2">
                                                        <Card card={card} />
                                                        <button onClick={() => { if (gold >= card.price) { setGold(prev => prev - card.price); setDeck(prev => [...prev, card]); let newShop = [...shopCards]; newShop[i] = null; setShopCards(newShop); } }} disabled={gold < card.price} className={`px-4 py-2 rounded-full font-bold text-sm ${gold >= card.price ? 'bg-yellow-500 text-black hover:bg-yellow-400' : 'bg-slate-600 text-slate-400'}`}>{card.price}ì›</button>
                                                    </div>
                                                ) : <div key={i} className="w-32 h-48 border-2 border-dashed border-slate-600 rounded flex items-center justify-center text-slate-500">í’ˆì ˆ</div> ))}
                                            </div>
                                            
                                            <div className="w-full max-w-4xl bg-red-900/20 p-6 rounded-xl border border-red-500/30 flex flex-col md:flex-row justify-between items-center gap-4">
                                                <div className="flex items-center gap-4">
                                                    <div className="text-4xl text-red-400"><Icon name="Trash2" /></div>
                                                    <div className="text-left">
                                                        <div className="font-bold text-xl text-red-200">ì¤‘ê³  ì„œì  íŒë§¤ (ì¹´ë“œ ì œê±°)</div>
                                                        <div className="text-sm text-red-300/70">ë±ì—ì„œ ì¹´ë“œë¥¼ 1ì¥ ì œê±°í•©ë‹ˆë‹¤.</div>
                                                    </div>
                                                </div>
                                                <button onClick={() => { if(gold>=2000) { setGameState('SHOP_REMOVE'); setTempSelected([]); } }} disabled={gold<2000} className={`px-6 py-3 rounded-lg font-bold whitespace-nowrap ${gold>=2000?'bg-red-600 hover:bg-red-500':'bg-slate-600 text-slate-400'}`}>2000ì›</button>
                                            </div>
                                            
                                            <button onClick={() => { setGameState('MAP'); generateStage(stage + 1); }} className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-16 rounded-full text-xl flex items-center gap-3 shadow-xl mt-8">êµì‹¤ë¡œ ëŒì•„ê°€ê¸° <Icon name="ArrowRight" /></button>
                                        </div>
                                    </div>
                                )}
                                
                                {gameState === 'LUNCH' && (
                                    <div className="flex-1 flex items-center justify-center p-4 bg-black/80 z-30">
                                        <div className="bg-slate-800 p-8 rounded-xl max-w-3xl w-full text-center border-2 border-green-600 shadow-2xl">
                                            <div className="text-6xl mb-4">ğŸ±</div>
                                            <h2 className="text-3xl font-bold text-white mb-4">ê¸‰ì‹ ì‹œê°„</h2>
                                            <p className="text-lg text-slate-300 mb-8">ë§›ìˆëŠ” ê¸‰ì‹ì´ ë‚˜ì™”ìŠµë‹ˆë‹¤.</p>
                                            <div className="flex gap-8 justify-center">
                                                <button onClick={() => { setHp(Math.min(maxHp, hp + 30)); setGameState('MAP'); generateStage(stage + 1); }} className="flex-1 bg-green-700 p-8 rounded-xl hover:bg-green-600 transition shadow-lg group"><div className="text-4xl mb-4 group-hover:scale-110 transition-transform">ğŸ˜‹</div><div className="font-bold text-xl mb-2">ë§›ìˆê²Œ ë¨¹ê¸°</div><div className="text-green-200">ì²´ë ¥ 30 íšŒë³µ</div></button>
                                                <button onClick={() => { setGameState('LUNCH_UPGRADE'); setTempSelected([]); }} className="flex-1 bg-red-700 p-8 rounded-xl hover:bg-red-600 transition shadow-lg group">
                                                    <div className="text-4xl mb-4 group-hover:scale-110 transition-transform">ğŸ¤¬</div>
                                                    <div className="font-bold text-xl mb-2">ë°˜ì°¬ íˆ¬ì •</div>
                                                    <div className="text-red-200">ì¹´ë“œ 2ì¥ ê°•í™”</div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {gameState === 'TEACHER_EVENT' && teacherEvent && (
                                    <div className="flex-1 flex items-center justify-center p-4 bg-black/80 z-30">
                                        <div className="bg-slate-800 p-8 rounded-xl max-w-xl w-full text-center border-2 border-blue-500 shadow-2xl">
                                            <div className="text-6xl mb-4">{teacherEvent.teacherEmoji}</div>
                                            <h2 className="text-2xl font-bold mb-2">{teacherEvent.teacher} ì„ ìƒë‹˜ì˜ ìƒë‹´</h2>
                                            <div className="flex gap-4 justify-center mt-8">
                                                <button onClick={() => handleTeacherChoice('REMOVE')} className="bg-red-600 hover:bg-red-500 p-4 rounded-lg flex-1 transition transform hover:scale-105"><div className="text-2xl">ğŸ—‘ï¸</div><div className="font-bold">ì¹´ë“œ ì œê±°</div></button>
                                                <button onClick={() => handleTeacherChoice('COPY')} className="bg-blue-600 hover:bg-blue-500 p-4 rounded-lg flex-1 transition transform hover:scale-105"><div className="text-2xl">ğŸ“</div><div className="font-bold">ì¹´ë“œ ë³µì‚¬</div></button>
                                                <button onClick={() => handleTeacherChoice('UPGRADE')} className="bg-green-600 hover:bg-green-500 p-4 rounded-lg flex-1 transition transform hover:scale-105"><div className="text-2xl">ğŸ”¨</div><div className="font-bold">ì¹´ë“œ ê°•í™”</div></button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {['TEACHER_REMOVE', 'TEACHER_COPY', 'TEACHER_UPGRADE', 'LUNCH_UPGRADE', 'SHOP_REMOVE'].includes(gameState) && (
                                    <div className="flex-1 overflow-y-auto p-8 relative bg-slate-900/95 z-20">
                                        <h2 className="text-3xl font-bold text-center mb-4 text-white">
                                            {gameState === 'TEACHER_REMOVE' && 'ì œê±°í•  ì¹´ë“œ ì„ íƒ (1ì¥)'}
                                            {gameState === 'SHOP_REMOVE' && 'ì œê±°í•  ì¹´ë“œ ì„ íƒ (ë¹„ìš©: 2000ì›)'}
                                            {gameState === 'TEACHER_COPY' && 'ë³µì‚¬í•  ì¹´ë“œ ì„ íƒ (1ì¥)'}
                                            {gameState === 'TEACHER_UPGRADE' && 'ê°•í™”í•  ì¹´ë“œ ì„ íƒ (1ì¥)'}
                                            {gameState === 'LUNCH_UPGRADE' && 'ê°•í™”í•  ì¹´ë“œ ì„ íƒ (2ì¥)'}
                                        </h2>
                                        <div className="text-center mb-8 text-slate-400">
                                            ì„ íƒë¨: {tempSelected.length} / {(gameState === 'LUNCH_UPGRADE') ? 2 : 1}
                                        </div>
                                        <div className="flex flex-wrap gap-4 justify-center pb-24">
                                            {deck.map((card, i) => (
                                                <div key={i} onClick={() => toggleCardSelection(i, (gameState === 'LUNCH_UPGRADE' ? 2 : 1))} className={`cursor-pointer transform transition-all ${tempSelected.includes(i) ? 'scale-110 ring-4 ring-yellow-400 rounded-lg z-10' : 'hover:scale-105 opacity-80 hover:opacity-100'}`}>
                                                    <Card card={card}/>
                                                    {tempSelected.includes(i) && <div className="absolute top-2 right-2 bg-yellow-400 text-black rounded-full p-1"><Icon name="CheckCircle" size={20}/></div>}
                                                </div>
                                            ))}
                                        </div>
                                        <div className="fixed bottom-8 left-0 w-full flex justify-center gap-4 z-50">
                                            <button onClick={() => { setGameState(gameState.startsWith('SHOP') ? 'SHOP' : gameState.startsWith('LUNCH') ? 'LUNCH' : 'MAP'); if(!gameState.startsWith('SHOP') && !gameState.startsWith('LUNCH')) generateStage(stage+1); }} className="bg-slate-600 hover:bg-slate-500 px-8 py-3 rounded-xl font-bold shadow-lg">ì·¨ì†Œ/ê±´ë„ˆë›°ê¸°</button>
                                            <button 
                                                onClick={confirmSelectionAction} 
                                                disabled={tempSelected.length === 0}
                                                className={`px-8 py-3 rounded-xl font-bold shadow-lg text-xl ${tempSelected.length > 0 ? 'bg-blue-600 hover:bg-blue-500 text-white' : 'bg-slate-700 text-slate-500 cursor-not-allowed'}`}
                                            >
                                                í™•ì¸ ({tempSelected.length})
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {(gameState === 'GAME_OVER' || gameState === 'VICTORY') && (
                                    <div className="absolute inset-0 bg-black/95 flex flex-col items-center justify-center z-50">
                                        <h1 className={`text-6xl font-black mb-4 ${gameState==='VICTORY'?'text-green-500':'text-red-500'}`}>{gameState === 'VICTORY' ? 'ğŸ† ì „ì„¤ì ì¸ ì¡¸ì—…ìƒ' : 'ğŸ’€ ìœ ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤...'}</h1>
                                        {gameState === 'VICTORY' && <div className="text-4xl mb-4">ğŸ“ ì¡¸ì—…ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ“</div>}
                                        {gameState === 'GAME_OVER' && <div className="text-2xl mb-4 text-slate-300">ì•ˆíƒ€ê¹ê²Œë„ ì§„ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤...</div>}
                                        <p className="text-2xl text-white mb-8">{stage}êµì‹œê¹Œì§€ ìƒì¡´</p>
                                        {/* [ì¶”ê°€] ìƒì„¸ ì„±ì í‘œ í‘œì‹œ */}
                                        <div className="bg-slate-800/80 p-6 rounded-xl border border-slate-600 mb-8 text-left w-full max-w-sm">
                                            <div className="flex justify-between text-slate-300 mb-1"><span>ê¸°ë³¸ ì ìˆ˜ ({stage}êµì‹œ)</span><span>+{stage * 100}</span></div>
                                            <div className="flex justify-between text-red-300 mb-1"><span>ê±´ê°• ì ìˆ˜ (HP {hp})</span><span>+{hp * 10}</span></div>
                                            <div className="flex justify-between text-blue-300 mb-1"><span>ë©˜íƒˆ ì ìˆ˜ (ìµœëŒ€ {maxMental})</span><span>+{maxMental * 500}</span></div>
                                            <div className="flex justify-between text-yellow-300 mb-1"><span>ê²½ì œ ì ìˆ˜ ({gold}ì›)</span><span>+{gold}</span></div>
                                            <div className="flex justify-between text-slate-400 mb-1"><span>ë± ì••ì¶• ê°ì  ({deck.length}ì¥)</span><span>-{deck.length * 50}</span></div>
                                            {stage >= 100 && <div className="flex justify-between text-green-400 font-bold mb-1"><span>ğŸ‰ ì¡¸ì—… ë³´ë„ˆìŠ¤</span><span>+10,000</span></div>}
                                            <div className="border-t border-slate-500 my-2"></div>
                                            <div className="flex justify-between text-2xl font-black text-white">
                                                <span>ì´ì </span>
                                                <span>
                                                    {Math.max(0, (stage * 100) + (hp * 10) + (maxMental * 500) + gold - (deck.length * 50) + (stage >= 100 ? 10000 : 0)).toLocaleString()}ì 
                                                </span>
                                            </div>
                                        </div>
                                        <div className="flex flex-col gap-4 mb-8 w-full max-w-sm">
                                            <input 
                                                type="text" 
                                                placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" 
                                                className="px-4 py-2 rounded text-black text-center font-bold"
                                                value={playerName}
                                                onChange={(e) => setPlayerName(e.target.value)}
                                                maxLength={10}
                                            />
                                            <button onClick={saveScore} className="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-6 rounded-lg">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
                                            <button onClick={copyScore} className="bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 px-6 rounded-lg">ì„±ì í‘œ ë³µì‚¬í•˜ê¸° (ê³µìœ )</button>
                                        </div>

                                        <button onClick={() => setGameState('MENU')} className="text-white underline hover:text-slate-300">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SchoolAscent />);
    </script>
</body>

</html>
